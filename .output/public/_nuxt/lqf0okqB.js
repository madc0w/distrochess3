import{y as R,n as w,j as l}from"./Cy8nOPVn.js";import{a as S,u as m}from"./Dx6LfG2l.js";function n(e,t){const u=e&&(typeof e=="string"?e:e.statusMessage||e.data?.statusMessage||e.code||e.error||e.message);if(!u)return t?.errors&&t.errors.ERR_GENERIC||"An error occurred";const o=String(u);return t?.errors&&t.errors[o]?t.errors[o]:o.startsWith("ERR_")&&t?.errors&&t.errors.ERR_GENERIC||o}function I(){const e=S("auth",()=>null),{t,setLocale:u,locale:o}=m();R(()=>{if(typeof window<"u")try{const r=localStorage.getItem("auth");r&&(e.value=JSON.parse(r))}catch{}e.value?.user?.preferredLocale&&u(e.value.user.preferredLocale,!0)}),w(e,r=>{typeof window>"u"||(r?localStorage.setItem("auth",JSON.stringify(r)):localStorage.removeItem("auth"),r?.user?.preferredLocale&&u(r.user.preferredLocale,!0))},{deep:!0});const f=l(()=>!!e.value);async function d(r,a,s){try{const c=o.value,i=await $fetch("/api/auth/signup",{method:"POST",body:{name:r,email:a,password:s,locale:c}});return e.value=i,i.user?.preferredLocale?u(i.user.preferredLocale,!0):u(c,!0),{success:!0}}catch(c){return console.error("Signup error:",c),{success:!1,error:n(c,t.value)||"Signup failed"}}}async function p(r,a){try{const s=await $fetch("/api/auth/signin",{method:"POST",body:{email:r,password:a}});return e.value=s,s.user?.preferredLocale&&u(s.user.preferredLocale,!0),{success:!0}}catch(s){return console.error("Signin error:",s),{success:!1,error:n(s,t.value)||"Signin failed"}}}function h(){e.value=null}async function g(r){try{return await $fetch("/api/auth/forgot-password",{method:"POST",body:{email:r,locale:o.value}}),{success:!0}}catch(a){return console.error("Forgot password error:",a),{success:!1,error:n(a,t.value)||t.value.errors?.ERR_GENERIC||"Request failed"}}}async function y(r,a){try{return await $fetch("/api/auth/reset-password",{method:"POST",body:{token:r,password:a}}),{success:!0}}catch(s){return console.error("Reset password error:",s),{success:!1,error:n(s,t.value)||t.value.errors?.ERR_GENERIC||"Reset failed"}}}function v(){if(e.value?.token)return{Authorization:`Bearer ${e.value.token}`}}return{auth:l(()=>e.value),user:l(()=>e.value?.user||null),isAuthenticated:f,signup:d,signin:p,signout:h,requestPasswordReset:g,resetPassword:y,getAuthHeader:v}}export{n as t,I as u};
//# sourceMappingURL=lqf0okqB.js.map
