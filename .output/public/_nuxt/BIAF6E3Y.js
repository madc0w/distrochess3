import{u as w}from"./Dx6LfG2l.js";import{g as k,x,m as b,j as l,y as I,c as i,a,t as o,k as c,o as u,_ as P}from"./Cy8nOPVn.js";const L={class:"resubscribe-page"},R={class:"card"},S={key:0},T={key:1},C={key:2,class:"error"},E={class:"links"},U=["href"],p="https://www.distrochess.com",$=k({__name:"resubscribe",setup(j){const f=x(),t=b("pending"),{t:s,setLocale:_}=w(),d=b("genericError"),m=l(()=>s.value.subscriptionPages.common[d.value]??""),n=l(()=>{const e=f.query.userId;return Array.isArray(e)?e[0]??"":typeof e=="string"?e:""}),h=l(()=>{const e=n.value;return e?`${p}/unsubscribe?userId=${encodeURIComponent(e)}&unsub=true`:`${p}/unsubscribe`});async function v(){if(!n.value){t.value="error",d.value="missingUser";return}try{const e=await fetch("/api/user/manageSub",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.value,isSubscribe:!0})});if(!e.ok){const r=await e.text();throw new Error(r||"Request failed")}t.value="success"}catch{t.value="error",d.value="updateFailed"}}async function y(){if(n.value)try{const e=await fetch(`/api/user/preferences?userId=${encodeURIComponent(n.value)}`);if(!e.ok){const g=await e.text();throw new Error(g||"Failed to load locale")}const r=await e.json();r.preferredLocale&&typeof r.preferredLocale=="string"&&_(r.preferredLocale,!0)}catch(e){console.error("Unable to sync preferred locale",e)}}return I(()=>{y(),v()}),(e,r)=>(u(),i("div",L,[a("div",R,[a("h1",null,o(c(s).subscriptionPages.resubscribe.title),1),t.value==="pending"?(u(),i("p",S,o(c(s).subscriptionPages.resubscribe.pending),1)):t.value==="success"?(u(),i("p",T,o(c(s).subscriptionPages.resubscribe.success),1)):(u(),i("p",C,o(m.value),1)),a("div",E,[a("a",{href:h.value},o(c(s).subscriptionPages.resubscribe.linkText),9,U),a("a",{href:p},o(c(s).subscriptionPages.common.returnHome),1)])])]))}}),q=P($,[["__scopeId","data-v-6dddea9d"]]);export{q as default};
//# sourceMappingURL=BIAF6E3Y.js.map
