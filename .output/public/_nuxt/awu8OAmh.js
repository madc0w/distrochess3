import{u as w}from"./Dx6LfG2l.js";import{g as k,x,m as f,j as d,y as I,c as u,a,t as o,k as c,o as i,_ as P}from"./Cy8nOPVn.js";const L={class:"unsubscribe-page"},S={class:"card"},T={key:0},U={key:1},C={key:2,class:"error"},E={class:"links"},R=["href"],p="https://www.distrochess.com",$=k({__name:"unsubscribe",setup(j){const b=x(),t=f("pending"),{t:s,setLocale:_}=w(),l=f("genericError"),m=d(()=>s.value.subscriptionPages.common[l.value]??""),n=d(()=>{const e=b.query.userId;return Array.isArray(e)?e[0]??"":typeof e=="string"?e:""}),h=d(()=>{const e=n.value;return e?`${p}/resubscribe?userId=${encodeURIComponent(e)}&unsub=false`:`${p}/resubscribe`});async function v(){if(!n.value){t.value="error",l.value="missingUser";return}try{const e=await fetch("/api/user/manageSub",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:n.value,isSubscribe:!1})});if(!e.ok){const r=await e.text();throw new Error(r||"Request failed")}t.value="success"}catch{t.value="error",l.value="updateFailed"}}async function y(){if(n.value)try{const e=await fetch(`/api/user/preferences?userId=${encodeURIComponent(n.value)}`);if(!e.ok){const g=await e.text();throw new Error(g||"Failed to load locale")}const r=await e.json();r.preferredLocale&&typeof r.preferredLocale=="string"&&_(r.preferredLocale,!0)}catch(e){console.error("Unable to sync preferred locale",e)}}return I(()=>{y(),v()}),(e,r)=>(i(),u("div",L,[a("div",S,[a("h1",null,o(c(s).subscriptionPages.unsubscribe.title),1),t.value==="pending"?(i(),u("p",T,o(c(s).subscriptionPages.unsubscribe.pending),1)):t.value==="success"?(i(),u("p",U,o(c(s).subscriptionPages.unsubscribe.success),1)):(i(),u("p",C,o(m.value),1)),a("div",E,[a("a",{href:h.value},o(c(s).subscriptionPages.unsubscribe.linkText),9,R),a("a",{href:p},o(c(s).subscriptionPages.common.returnHome),1)])])]))}}),q=P($,[["__scopeId","data-v-c434a7c1"]]);export{q as default};
//# sourceMappingURL=awu8OAmh.js.map
