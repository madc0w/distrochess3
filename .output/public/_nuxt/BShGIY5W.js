import{_ as z}from"./7vXxnD6-.js";import{g as K,v as G,m as v,K as N,j as D,n as H,c as d,a as e,l as Q,s as h,b as J,t as l,k as n,w as X,B as V,C as f,D as L,L as Y,F as Z,r as ee,M as F,q as ae,T as se,o as u,d as te,_ as le}from"./Cy8nOPVn.js";import{u as oe,t as x}from"./lqf0okqB.js";import{u as ne}from"./BLm2Lqux.js";import{u as re,a as ie,e as R}from"./Dx6LfG2l.js";import{f as ue}from"./BYtXdY39.js";const de={class:"settings-page"},ce={class:"settings-card"},pe={class:"card-header"},ve={key:0,class:"alert alert-error"},me={key:1,class:"alert alert-success"},fe={key:2,class:"loading-state"},ge={class:"form-grid"},_e={class:"form-group"},we={for:"name"},he={class:"form-group"},be={for:"email"},ye={class:"form-group form-group-full"},ke={class:"form-group"},Pe={for:"language",class:"language-label"},Le=["value"],Oe={class:"form-group form-group-full"},Ce={class:"radio-group"},Se={class:"radio-label"},De={class:"radio-label"},Ve=["disabled"],xe={key:4,class:"empty-state"},Me={key:5,class:"readonly-grid"},Te={class:"readonly-card"},Ue={class:"label"},Ne={class:"readonly-card"},Fe={class:"label"},Re={class:"modal-header"},Ee={class:"form-group"},qe={for:"currentPassword"},Be={key:0,class:"error-message"},Ae={class:"form-group"},We={for:"newPassword"},Ie={class:"modal-actions"},$e=["disabled"],je=K({__name:"settings",setup(ze){const w=G(),{t:s,setLocale:M,locale:E}=re(),{isAuthenticated:O,getAuthHeader:C}=oe(),b=ie("auth"),o=v(null),S=v(!1),y=v(!1),p=v(""),m=v(""),t=N({name:"",email:"",preferredLocale:"en",duckOpinion:void 0}),k=v(!1),P=v(!1),g=v(!1),c=N({currentPassword:"",newPassword:""});function T(r){return{...r,createdDate:r.createdDate?new Date(r.createdDate):null}}const q=D(()=>{const r=s.value.languages;return Object.keys(R.languages).map(a=>({value:a,label:r[a]||R.languages[a]}))}),B=D(()=>ue(o.value?.createdDate??null,o.value?.preferredLocale||E.value||"en")),U=D(()=>{if(!o.value)return!1;const r=t.preferredLocale||"en",a=o.value.preferredLocale||"en";return!y.value&&(t.name!==o.value.name||t.email!==o.value.email||r!==a||t.duckOpinion!==o.value.duckOpinion)});async function A(){if(!O.value)return;const r=C();if(!r){await w.replace("/");return}S.value=!0,p.value="";try{const a=await $fetch("/api/user",{headers:r});o.value=T(a),t.name=o.value.name,t.email=o.value.email,t.preferredLocale=o.value.preferredLocale||"en",t.duckOpinion=o.value.duckOpinion,M(t.preferredLocale,!0)}catch(a){p.value=x(a,s.value)||"Failed to load settings.",a?.statusCode===401&&await w.replace("/")}finally{S.value=!1}}async function W(){if(!o.value||!U.value)return;const r=C();if(!r){await w.replace("/");return}y.value=!0,p.value="",m.value="";try{const a=await $fetch("/api/user",{method:"PUT",headers:r,body:{name:t.name,email:t.email,preferredLocale:t.preferredLocale,duckOpinion:t.duckOpinion}});o.value=T(a),t.name=o.value.name,t.email=o.value.email,t.preferredLocale=o.value.preferredLocale||"en",t.duckOpinion=o.value.duckOpinion,M(t.preferredLocale,!0),m.value=s.value.settings.updateSuccess,b.value&&(b.value={...b.value,user:{...b.value.user,name:a.name,email:a.email,preferredLocale:a.preferredLocale}})}catch(a){p.value=x(a,s.value)||"Failed to save settings."}finally{y.value=!1}}function I(){k.value=!0,g.value=!1,c.currentPassword="",c.newPassword=""}function _(){k.value=!1,g.value=!1,c.currentPassword="",c.newPassword=""}async function $(){if(!O.value)return;const r=C();if(!r){await w.replace("/");return}P.value=!0,g.value=!1,p.value="",m.value="";try{await $fetch("/api/user/change-password",{method:"POST",headers:r,body:{currentPassword:c.currentPassword,newPassword:c.newPassword}}),m.value=s.value.settings.passwordChanged,_()}catch(a){a?.statusCode===401&&a?.statusMessage==="ERR_INCORRECT_PASSWORD"?g.value=!0:(p.value=x(a,s.value)||"Failed to change password.",_())}finally{P.value=!1}}return ne(()=>{k.value&&_()}),H(()=>O.value,async r=>{if(!r){o.value=null,m.value="",await w.replace("/");return}await A()},{immediate:!0}),(r,a)=>{const j=z;return u(),d("div",de,[e("div",ce,[e("div",pe,[e("div",null,[e("h1",null,l(n(s).settings.title),1),e("p",null,l(n(s).settings.subtitle),1)]),J(j,{to:"/",class:"back-link"},{default:X(()=>[te(l(n(s).settings.backToGames),1)]),_:1})]),p.value?(u(),d("div",ve,l(p.value),1)):h("",!0),m.value?(u(),d("div",me,l(m.value),1)):h("",!0),S.value?(u(),d("div",fe,[a[8]||(a[8]=e("div",{class:"spinner","aria-hidden":"true"},null,-1)),e("p",null,l(n(s).pleaseWait),1)])):o.value?(u(),d("form",{key:3,class:"settings-form",onSubmit:V(W,["prevent"])},[e("div",ge,[e("div",_e,[e("label",we,l(n(s).name),1),f(e("input",{id:"name",type:"text",required:"","onUpdate:modelValue":a[0]||(a[0]=i=>t.name=i)},null,512),[[L,t.name]])]),e("div",he,[e("label",be,l(n(s).email),1),f(e("input",{id:"email",type:"email",required:"","onUpdate:modelValue":a[1]||(a[1]=i=>t.email=i)},null,512),[[L,t.email]])]),e("div",ye,[e("button",{type:"button",class:"btn-change-password",onClick:I},l(n(s).settings.changePassword),1)]),e("div",ke,[e("label",Pe,l(n(s).settings.language),1),f(e("select",{id:"language","onUpdate:modelValue":a[2]||(a[2]=i=>t.preferredLocale=i)},[(u(!0),d(Z,null,ee(q.value,i=>(u(),d("option",{key:i.value,value:i.value},l(i.label),9,Le))),128))],512),[[Y,t.preferredLocale]])]),e("div",Oe,[e("label",null,l(n(s).settings.duckQuestion),1),e("div",Ce,[e("label",Se,[f(e("input",{type:"radio",name:"duckOpinion",value:"favor","onUpdate:modelValue":a[3]||(a[3]=i=>t.duckOpinion=i)},null,512),[[F,t.duckOpinion]]),e("span",null,l(n(s).settings.duckFavor),1)]),e("label",De,[f(e("input",{type:"radio",name:"duckOpinion",value:"opposed","onUpdate:modelValue":a[4]||(a[4]=i=>t.duckOpinion=i)},null,512),[[F,t.duckOpinion]]),e("span",null,l(n(s).settings.duckOpposed),1)])])])]),e("button",{type:"submit",class:"btn-primary",disabled:!U.value},l(y.value?n(s).pleaseWait:n(s).settings.save),9,Ve)],32)):(u(),d("div",xe,[e("p",null,l(p.value||"No profile data available."),1)])),o.value?(u(),d("div",Me,[e("div",Te,[e("span",Ue,l(n(s).settings.signupDate),1),e("strong",null,l(B.value),1)]),e("div",Ne,[e("span",Fe,l(n(s).score),1),e("strong",null,l(o.value.score),1)])])):h("",!0)]),(u(),Q(se,{to:"body"},[k.value?(u(),d("div",{key:0,class:"modal-overlay",onClick:_},[e("div",{class:"modal-content",onClick:a[7]||(a[7]=V(()=>{},["stop"]))},[e("div",Re,[e("h2",null,l(n(s).settings.changePasswordTitle),1),e("button",{class:"close-btn",onClick:_,"aria-label":"Close"}," Ã— ")]),e("form",{onSubmit:V($,["prevent"]),class:"password-form"},[e("div",Ee,[e("label",qe,l(n(s).settings.currentPassword),1),f(e("input",{id:"currentPassword",type:"password",required:"","onUpdate:modelValue":a[5]||(a[5]=i=>c.currentPassword=i),class:ae({"input-error":g.value})},null,2),[[L,c.currentPassword]]),g.value?(u(),d("span",Be,l(n(s).settings.incorrectPassword),1)):h("",!0)]),e("div",Ae,[e("label",We,l(n(s).settings.newPassword),1),f(e("input",{id:"newPassword",type:"password",required:"",minlength:"6","onUpdate:modelValue":a[6]||(a[6]=i=>c.newPassword=i)},null,512),[[L,c.newPassword]])]),e("div",Ie,[e("button",{type:"button",class:"btn-secondary",onClick:_},l(n(s).settings.cancel),1),e("button",{type:"submit",class:"btn-primary",disabled:P.value},l(P.value?n(s).pleaseWait:n(s).settings.setNewPassword),9,$e)])],32)])])):h("",!0)]))])}}}),Ye=le(je,[["__scopeId","data-v-51754f21"]]);export{Ye as default};
//# sourceMappingURL=BShGIY5W.js.map
