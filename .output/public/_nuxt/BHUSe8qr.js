import{p as Ps,g as ds,m as U,j as le,n as Xe,c as z,a as k,F as Mn,r as fs,o as q,q as at,s as ue,t as C,_ as hs,v as Ls,x as Ns,y as Rs,z as Hn,b as vn,k as x,w as Vn,l as Fs,A as Bs,d as rt,T as Us,B as Pe,C as Ks,D as Gs,E as qs,G as Wn,H as zs}from"./Cy8nOPVn.js";import{_ as Hs}from"./7vXxnD6-.js";import{_ as Vs}from"./BiKj_LO7.js";import{u as Ws,t as Ue}from"./lqf0okqB.js";import{u as Qs}from"./BLm2Lqux.js";import{u as Ys}from"./Dx6LfG2l.js";import{f as Xs}from"./BYtXdY39.js";import{s as Qn}from"./KdOoEFN1.js";const Zs=Ps("/settings.svg");function Js(s){return s!==null?{comment:s,variations:[]}:{variations:[]}}function eo(s,e,t,n,i){const o={move:s,variations:i};return e&&(o.suffix=e),t&&(o.nag=t),n!==null&&(o.comment=n),o}function to(...s){const[e,...t]=s;let n=e;for(const i of t)i!==null&&(n.variations=[i,...i.variations],i.variations=[],n=i);return e}function no(s,e){if(e.marker&&e.marker.comment){let t=e.root;for(;;){const n=t.variations[0];if(!n){t.comment=e.marker.comment;break}t=n}}return{headers:s,root:e.root,result:(e.marker&&e.marker.result)??void 0}}function so(s,e){function t(){this.constructor=s}t.prototype=e.prototype,s.prototype=new t}function ct(s,e,t,n){var i=Error.call(this,s);return Object.setPrototypeOf&&Object.setPrototypeOf(i,ct.prototype),i.expected=e,i.found=t,i.location=n,i.name="SyntaxError",i}so(ct,Error);function gn(s,e,t){return t=t||" ",s.length>e?s:(e-=s.length,t+=t.repeat(e),s+t.slice(0,e))}ct.prototype.format=function(s){var e="Error: "+this.message;if(this.location){var t=null,n;for(n=0;n<s.length;n++)if(s[n].source===this.location.source){t=s[n].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,o=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,a=this.location.source+":"+o.line+":"+o.column;if(t){var l=this.location.end,d=gn("",o.line.toString().length," "),r=t[i.line-1],g=i.line===l.line?l.column:r.length+1,y=g-i.column||1;e+=`
 --> `+a+`
`+d+` |
`+o.line+" | "+r+`
`+d+" | "+gn("",i.column-1," ")+gn("",y,"^")}else e+=`
 at `+a}return e};ct.buildMessage=function(s,e){var t={literal:function(r){return'"'+i(r.text)+'"'},class:function(r){var g=r.parts.map(function(y){return Array.isArray(y)?o(y[0])+"-"+o(y[1]):o(y)});return"["+(r.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(r){return r.description}};function n(r){return r.charCodeAt(0).toString(16).toUpperCase()}function i(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+n(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+n(g)})}function o(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+n(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+n(g)})}function a(r){return t[r.type](r)}function l(r){var g=r.map(a),y,h;if(g.sort(),g.length>0){for(y=1,h=1;y<g.length;y++)g[y-1]!==g[y]&&(g[h]=g[y],h++);g.length=h}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function d(r){return r?'"'+i(r)+'"':"end of input"}return"Expected "+l(s)+" but "+d(e)+" found."};function oo(s,e){e=e!==void 0?e:{};var t={},n=e.grammarSource,i={pgn:nt},o=nt,a="[",l='"',d="]",r=".",g="O-O-O",y="O-O",h="0-0-0",b="0-0",$="$",F="{",H="}",ne=";",S="(",K=")",Z="1-0",V="0-1",J="1/2-1/2",he="*",T=/^[a-zA-Z]/,j=/^[^"]/,R=/^[0-9]/,G=/^[.]/,Y=/^[a-zA-Z1-8\-=]/,ie=/^[+#]/,ge=/^[!?]/,Ne=/^[^}]/,je=/^[^\r\n]/,pe=/^[ \t\r\n]/,Me=ve("tag pair"),ze=X("[",!1),Re=X('"',!1),xe=X("]",!1),ke=ve("tag name"),Ce=be([["a","z"],["A","Z"]],!1,!1),tt=ve("tag value"),He=be(['"'],!0,!1),Te=ve("move number"),Ie=be([["0","9"]],!1,!1),Fe=X(".",!1),Ve=be(["."],!1,!1),_=ve("standard algebraic notation"),E=X("O-O-O",!1),M=X("O-O",!1),B=X("0-0-0",!1),ee=X("0-0",!1),te=be([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),fe=be(["+","#"],!1,!1),Be=ve("suffix annotation"),ft=be(["!","?"],!1,!1),ce=ve("NAG"),qt=X("$",!1),zt=ve("brace comment"),ht=X("{",!1),Et=be(["}"],!0,!1),Ht=X("}",!1),Vt=ve("rest of line comment"),Wt=X(";",!1),wt=be(["\r",`
`],!0,!1),Qt=ve("variation"),Yt=X("(",!1),Xt=X(")",!1),pt=ve("game termination marker"),Zt=X("1-0",!1),Jt=X("0-1",!1),en=X("1/2-1/2",!1),tn=X("*",!1),nn=ve("whitespace"),St=be([" ","	","\r",`
`],!1,!1),sn=function(c,p){return no(c,p)},me=function(c){return Object.fromEntries(c)},on=function(c,p){return[c,p]},rn=function(c,p){return{root:c,marker:p}},Ct=function(c,p){return to(Js(c),...p.flat())},an=function(c,p,m,A,O){return eo(c,p,m,A,O)},ln=function(c){return c},cn=function(c){return c.replace(/[\r\n]+/g," ")},un=function(c){return c.trim()},dn=function(c){return c},Oe=function(c,p){return{result:c,comment:p}},f=e.peg$currPos|0,Ee=[{line:1,column:1}],_e=f,Ae=e.peg$maxFailExpected||[],w=e.peg$silentFails|0,We;if(e.startRule){if(!(e.startRule in i))throw new Error(`Can't start parsing from rule "`+e.startRule+'".');o=i[e.startRule]}function X(c,p){return{type:"literal",text:c,ignoreCase:p}}function be(c,p,m){return{type:"class",parts:c,inverted:p,ignoreCase:m}}function fn(){return{type:"end"}}function ve(c){return{type:"other",description:c}}function Tt(c){var p=Ee[c],m;if(p)return p;if(c>=Ee.length)m=Ee.length-1;else for(m=c;!Ee[--m];);for(p=Ee[m],p={line:p.line,column:p.column};m<c;)s.charCodeAt(m)===10?(p.line++,p.column=1):p.column++,m++;return Ee[c]=p,p}function mt(c,p,m){var A=Tt(c),O=Tt(p),W={source:n,start:{offset:c,line:A.line,column:A.column},end:{offset:p,line:O.line,column:O.column}};return W}function I(c){f<_e||(f>_e&&(_e=f,Ae=[]),Ae.push(c))}function hn(c,p,m){return new ct(ct.buildMessage(c,p),c,p,m)}function nt(){var c,p,m;return c=f,p=It(),m=De(),c=sn(p,m),c}function It(){var c,p,m;for(c=f,p=[],m=xt();m!==t;)p.push(m),m=xt();return m=Q(),c=me(p),c}function xt(){var c,p,m,A,O,W,Qe;return w++,c=f,Q(),s.charCodeAt(f)===91?(p=a,f++):(p=t,w===0&&I(ze)),p!==t?(Q(),m=pn(),m!==t?(Q(),s.charCodeAt(f)===34?(A=l,f++):(A=t,w===0&&I(Re)),A!==t?(O=mn(),s.charCodeAt(f)===34?(W=l,f++):(W=t,w===0&&I(Re)),W!==t?(Q(),s.charCodeAt(f)===93?(Qe=d,f++):(Qe=t,w===0&&I(xe)),Qe!==t?c=on(m,O):(f=c,c=t)):(f=c,c=t)):(f=c,c=t)):(f=c,c=t)):(f=c,c=t),w--,c===t&&w===0&&I(Me),c}function pn(){var c,p,m;if(w++,c=f,p=[],m=s.charAt(f),T.test(m)?f++:(m=t,w===0&&I(Ce)),m!==t)for(;m!==t;)p.push(m),m=s.charAt(f),T.test(m)?f++:(m=t,w===0&&I(Ce));else p=t;return p!==t?c=s.substring(c,f):c=p,w--,c===t&&(p=t,w===0&&I(ke)),c}function mn(){var c,p,m;for(w++,c=f,p=[],m=s.charAt(f),j.test(m)?f++:(m=t,w===0&&I(He));m!==t;)p.push(m),m=s.charAt(f),j.test(m)?f++:(m=t,w===0&&I(He));return c=s.substring(c,f),w--,p=t,w===0&&I(tt),c}function De(){var c,p,m;return c=f,p=st(),Q(),m=Se(),m===t&&(m=null),Q(),c=rn(p,m),c}function st(){var c,p,m,A;for(c=f,p=v(),p===t&&(p=null),m=[],A=ot();A!==t;)m.push(A),A=ot();return c=Ct(p,m),c}function ot(){var c,p,m,A,O,W,Qe,$t;if(c=f,Q(),vt(),Q(),p=At(),p!==t){for(m=it(),m===t&&(m=null),A=[],O=u();O!==t;)A.push(O),O=u();for(O=Q(),W=v(),W===t&&(W=null),Qe=[],$t=we();$t!==t;)Qe.push($t),$t=we();c=an(p,m,A,W,Qe)}else f=c,c=t;return c}function vt(){var c,p,m,A,O,W;for(w++,c=f,p=[],m=s.charAt(f),R.test(m)?f++:(m=t,w===0&&I(Ie));m!==t;)p.push(m),m=s.charAt(f),R.test(m)?f++:(m=t,w===0&&I(Ie));if(s.charCodeAt(f)===46?(m=r,f++):(m=t,w===0&&I(Fe)),m!==t){for(A=Q(),O=[],W=s.charAt(f),G.test(W)?f++:(W=t,w===0&&I(Ve));W!==t;)O.push(W),W=s.charAt(f),G.test(W)?f++:(W=t,w===0&&I(Ve));p=[p,m,A,O],c=p}else f=c,c=t;return w--,c===t&&(p=t,w===0&&I(Te)),c}function At(){var c,p,m,A,O,W;if(w++,c=f,p=f,s.substr(f,5)===g?(m=g,f+=5):(m=t,w===0&&I(E)),m===t&&(s.substr(f,3)===y?(m=y,f+=3):(m=t,w===0&&I(M)),m===t&&(s.substr(f,5)===h?(m=h,f+=5):(m=t,w===0&&I(B)),m===t&&(s.substr(f,3)===b?(m=b,f+=3):(m=t,w===0&&I(ee)),m===t))))if(m=f,A=s.charAt(f),T.test(A)?f++:(A=t,w===0&&I(Ce)),A!==t){if(O=[],W=s.charAt(f),Y.test(W)?f++:(W=t,w===0&&I(te)),W!==t)for(;W!==t;)O.push(W),W=s.charAt(f),Y.test(W)?f++:(W=t,w===0&&I(te));else O=t;O!==t?(A=[A,O],m=A):(f=m,m=t)}else f=m,m=t;return m!==t?(A=s.charAt(f),ie.test(A)?f++:(A=t,w===0&&I(fe)),A===t&&(A=null),m=[m,A],p=m):(f=p,p=t),p!==t?c=s.substring(c,f):c=p,w--,c===t&&(p=t,w===0&&I(_)),c}function it(){var c,p,m;for(w++,c=f,p=[],m=s.charAt(f),ge.test(m)?f++:(m=t,w===0&&I(ft));m!==t;)p.push(m),p.length>=2?m=t:(m=s.charAt(f),ge.test(m)?f++:(m=t,w===0&&I(ft)));return p.length<1?(f=c,c=t):c=p,w--,c===t&&(p=t,w===0&&I(Be)),c}function u(){var c,p,m,A,O;if(w++,c=f,Q(),s.charCodeAt(f)===36?(p=$,f++):(p=t,w===0&&I(qt)),p!==t){if(m=f,A=[],O=s.charAt(f),R.test(O)?f++:(O=t,w===0&&I(Ie)),O!==t)for(;O!==t;)A.push(O),O=s.charAt(f),R.test(O)?f++:(O=t,w===0&&I(Ie));else A=t;A!==t?m=s.substring(m,f):m=A,m!==t?c=ln(m):(f=c,c=t)}else f=c,c=t;return w--,c===t&&w===0&&I(ce),c}function v(){var c;return c=L(),c===t&&(c=D()),c}function L(){var c,p,m,A,O;if(w++,c=f,s.charCodeAt(f)===123?(p=F,f++):(p=t,w===0&&I(ht)),p!==t){for(m=f,A=[],O=s.charAt(f),Ne.test(O)?f++:(O=t,w===0&&I(Et));O!==t;)A.push(O),O=s.charAt(f),Ne.test(O)?f++:(O=t,w===0&&I(Et));m=s.substring(m,f),s.charCodeAt(f)===125?(A=H,f++):(A=t,w===0&&I(Ht)),A!==t?c=cn(m):(f=c,c=t)}else f=c,c=t;return w--,c===t&&(p=t,w===0&&I(zt)),c}function D(){var c,p,m,A,O;if(w++,c=f,s.charCodeAt(f)===59?(p=ne,f++):(p=t,w===0&&I(Wt)),p!==t){for(m=f,A=[],O=s.charAt(f),je.test(O)?f++:(O=t,w===0&&I(wt));O!==t;)A.push(O),O=s.charAt(f),je.test(O)?f++:(O=t,w===0&&I(wt));m=s.substring(m,f),c=un(m)}else f=c,c=t;return w--,c===t&&(p=t,w===0&&I(Vt)),c}function we(){var c,p,m,A;return w++,c=f,Q(),s.charCodeAt(f)===40?(p=S,f++):(p=t,w===0&&I(Yt)),p!==t?(m=st(),m!==t?(Q(),s.charCodeAt(f)===41?(A=K,f++):(A=t,w===0&&I(Xt)),A!==t?c=dn(m):(f=c,c=t)):(f=c,c=t)):(f=c,c=t),w--,c===t&&w===0&&I(Qt),c}function Se(){var c,p,m;return w++,c=f,s.substr(f,3)===Z?(p=Z,f+=3):(p=t,w===0&&I(Zt)),p===t&&(s.substr(f,3)===V?(p=V,f+=3):(p=t,w===0&&I(Jt)),p===t&&(s.substr(f,7)===J?(p=J,f+=7):(p=t,w===0&&I(en)),p===t&&(s.charCodeAt(f)===42?(p=he,f++):(p=t,w===0&&I(tn))))),p!==t?(Q(),m=v(),m===t&&(m=null),c=Oe(p,m)):(f=c,c=t),w--,c===t&&(p=t,w===0&&I(pt)),c}function Q(){var c,p;for(w++,c=[],p=s.charAt(f),pe.test(p)?f++:(p=t,w===0&&I(St));p!==t;)c.push(p),p=s.charAt(f),pe.test(p)?f++:(p=t,w===0&&I(St));return w--,p=t,w===0&&I(nn),c}if(We=o(),e.peg$library)return{peg$result:We,peg$currPos:f,peg$FAILED:t,peg$maxFailExpected:Ae,peg$maxFailPos:_e};if(We!==t&&f===s.length)return We;throw We!==t&&f<s.length&&I(fn()),hn(Ae,_e<s.length?s.charAt(_e):null,_e<s.length?mt(_e,_e+1):mt(_e,_e))}const Lt=0xffffffffffffffffn;function _n(s,e){return(s<<e|s>>64n-e)&0xffffffffffffffffn}function Yn(s,e){return s*e&Lt}function io(s){return function(){let e=BigInt(s&Lt),t=BigInt(s>>64n&Lt);const n=Yn(_n(Yn(e,5n),7n),9n);return t^=e,e=(_n(e,24n)^t^t<<16n)&Lt,t=_n(t,37n),s=t<<64n|e,n}}const Gt=io(0xa187eb39cdcaed8f31c4b365b102e01en),ro=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Gt()))),ao=Array.from({length:8},()=>Gt()),lo=Array.from({length:16},()=>Gt()),bn=Gt(),de="w",ye="b",se="p",On="n",Nt="b",bt="r",qe="q",oe="k",yn="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class jt{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,t){const{color:n,piece:i,from:o,to:a,flags:l,captured:d,promotion:r}=t,g=re(o),y=re(a);this.color=n,this.piece=i,this.from=g,this.to=y,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=g+y,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const h in N)N[h]&l&&(this.flags+=Ye[h]);d&&(this.captured=d),r&&(this.promotion=r,this.lan+=r)}isCapture(){return this.flags.indexOf(Ye.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ye.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ye.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ye.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ye.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ye.BIG_PAWN)>-1}}const ae=-1,Ye={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},N={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Dn={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},co={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},uo={...Dn,...co},P={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},kn={b:[16,32,17,15],w:[-16,-32,-17,-15]},Xn={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},fo=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],ho=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],po={p:1,n:2,b:4,r:8,q:16,k:32},mo="pnbrqkPNBRQK",Zn=[On,Nt,bt,qe],vo=7,go=6,_o=1,bo=0,Mt={[oe]:N.KSIDE_CASTLE,[qe]:N.QSIDE_CASTLE},Ke={w:[{square:P.a1,flag:N.QSIDE_CASTLE},{square:P.h1,flag:N.KSIDE_CASTLE}],b:[{square:P.a8,flag:N.QSIDE_CASTLE},{square:P.h8,flag:N.KSIDE_CASTLE}]},yo={b:_o,w:go},En="--";function Ze(s){return s>>4}function kt(s){return s&15}function ps(s){return"0123456789".indexOf(s)!==-1}function re(s){const e=kt(s),t=Ze(s);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function gt(s){return s===de?ye:de}function ko(s){const e=s.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const n=parseInt(e[4],10);if(isNaN(n)||n<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<i.length;a++){let l=0,d=!1;for(let r=0;r<i[a].length;r++)if(ps(i[a][r])){if(d)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(i[a][r],10),d=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[a][r]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,d=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const o=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of o){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(i[0]+i[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Eo(s,e){const t=s.from,n=s.to,i=s.piece;let o=0,a=0,l=0;for(let d=0,r=e.length;d<r;d++){const g=e[d].from,y=e[d].to,h=e[d].piece;i===h&&t!==g&&n===y&&(o++,Ze(t)===Ze(g)&&a++,kt(t)===kt(g)&&l++)}return o>0?a>0&&l>0?re(t):l>0?re(t).charAt(1):re(t).charAt(0):""}function Ge(s,e,t,n,i,o=void 0,a=N.NORMAL){const l=Ze(n);if(i===se&&(l===vo||l===bo))for(let d=0;d<Zn.length;d++){const r=Zn[d];s.push({color:e,from:t,to:n,piece:i,captured:o,promotion:r,flags:a|N.PROMOTION})}else s.push({color:e,from:t,to:n,piece:i,captured:o,flags:a})}function Jn(s){let e=s.charAt(0);return e>="a"&&e<="h"?s.match(/[a-h]\d.*[a-h]\d/)?void 0:se:(e=e.toLowerCase(),e==="o"?oe:e)}function wn(s){return s.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Pn{_board=new Array(128);_turn=de;_header={};_kings={w:ae,b:ae};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_hash=0n;_positionCount=new Map;constructor(e=yn,{skipValidation:t=!1}={}){this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:ae,b:ae},this._turn=de,this._castling={w:0,b:0},this._epSquare=ae,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...uo},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:n=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const l=["-","-","0","1"];e=i.concat(l.slice(-(6-i.length))).join(" ")}if(i=e.split(/\s+/),!t){const{ok:l,error:d}=ko(e);if(!l)throw new Error(d)}const o=i[0];let a=0;this.clear({preserveHeaders:n});for(let l=0;l<o.length;l++){const d=o.charAt(l);if(d==="/")a+=8;else if(ps(d))a+=parseInt(d,10);else{const r=d<"a"?de:ye;this._put({type:d.toLowerCase(),color:r},re(a)),a++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=N.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=N.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=N.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=N.QSIDE_CASTLE),this._epSquare=i[3]==="-"?ae:P[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(e),this._incPositionCount()}fen({forceEnpassantSquare:e=!1}={}){let t=0,n="";for(let a=P.a8;a<=P.h1;a++){if(this._board[a]){t>0&&(n+=t,t=0);const{color:l,type:d}=this._board[a];n+=l===de?d.toUpperCase():d.toLowerCase()}else t++;a+1&136&&(t>0&&(n+=t),a!==P.h1&&(n+="/"),t=0,a+=8)}let i="";this._castling[de]&N.KSIDE_CASTLE&&(i+="K"),this._castling[de]&N.QSIDE_CASTLE&&(i+="Q"),this._castling[ye]&N.KSIDE_CASTLE&&(i+="k"),this._castling[ye]&N.QSIDE_CASTLE&&(i+="q"),i=i||"-";let o="-";if(this._epSquare!==ae)if(e)o=re(this._epSquare);else{const a=this._epSquare+(this._turn===de?16:-16),l=[a+1,a-1];for(const d of l){if(d&136)continue;const r=this._turn;if(this._board[d]?.color===r&&this._board[d]?.type===se){this._makeMove({color:r,from:d,to:this._epSquare,piece:se,captured:se,flags:N.EP_CAPTURE});const g=!this._isKingAttacked(r);if(this._undoMove(),g){o=re(this._epSquare);break}}}}return[n,this._turn,i,o,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(e){if(!this._board[e])return 0n;const{color:t,type:n}=this._board[e],i={w:0,b:1}[t],o={p:0,n:1,b:2,r:3,q:4,k:5}[n];return ro[i][o][e]}_epKey(){return this._epSquare===ae?0n:ao[this._epSquare&7]}_castlingKey(){const e=this._castling.w>>5|this._castling.b>>3;return lo[e]}_computeHash(){let e=0n;for(let t=P.a8;t<=P.h1;t++){if(t&136){t+=7;continue}this._board[t]&&(e^=this._pieceKey(t))}return e^=this._epKey(),e^=this._castlingKey(),this._turn==="b"&&(e^=bn),e}_updateSetup(e){this._history.length>0||(e!==yn?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(yn)}get(e){return this._board[P[e]]}findPiece(e){const t=[];for(let n=P.a8;n<=P.h1;n++){if(n&136){n+=7;continue}!this._board[n]||this._board[n]?.color!==e.color||this._board[n].color===e.color&&this._board[n].type===e.type&&t.push(re(n))}return t}put({type:e,color:t},n){return this._put({type:e,color:t},n)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(e,t){this._hash^=this._pieceKey(e),this._board[e]=t,this._hash^=this._pieceKey(e)}_put({type:e,color:t},n){if(mo.indexOf(e.toLowerCase())===-1||!(n in P))return!1;const i=P[n];if(e==oe&&!(this._kings[t]==ae||this._kings[t]==i))return!1;const o=this._board[i];return o&&o.type===oe&&(this._kings[o.color]=ae),this._set(i,{type:e,color:t}),e===oe&&(this._kings[t]=i),!0}_clear(e){this._hash^=this._pieceKey(e),delete this._board[e]}remove(e){const t=this.get(e);return this._clear(P[e]),t&&t.type===oe&&(this._kings[t.color]=ae),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){this._hash^=this._castlingKey();const e=this._board[P.e1]?.type===oe&&this._board[P.e1]?.color===de,t=this._board[P.e8]?.type===oe&&this._board[P.e8]?.color===ye;(!e||this._board[P.a1]?.type!==bt||this._board[P.a1]?.color!==de)&&(this._castling.w&=-65),(!e||this._board[P.h1]?.type!==bt||this._board[P.h1]?.color!==de)&&(this._castling.w&=-33),(!t||this._board[P.a8]?.type!==bt||this._board[P.a8]?.color!==ye)&&(this._castling.b&=-65),(!t||this._board[P.h8]?.type!==bt||this._board[P.h8]?.color!==ye)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===ae)return;const e=this._epSquare+(this._turn===de?-16:16),t=this._epSquare+(this._turn===de?16:-16),n=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||this._board[t]?.color!==gt(this._turn)||this._board[t]?.type!==se){this._hash^=this._epKey(),this._epSquare=ae;return}const i=o=>!(o&136)&&this._board[o]?.color===this._turn&&this._board[o]?.type===se;n.some(i)||(this._hash^=this._epKey(),this._epSquare=ae)}_attacked(e,t,n){const i=[];for(let o=P.a8;o<=P.h1;o++){if(o&136){o+=7;continue}if(this._board[o]===void 0||this._board[o].color!==e)continue;const a=this._board[o],l=o-t;if(l===0)continue;const d=l+119;if(fo[d]&po[a.type]){if(a.type===se){if(l>0&&a.color===de||l<=0&&a.color===ye)if(n)i.push(re(o));else return!0;continue}if(a.type==="n"||a.type==="k")if(n){i.push(re(o));continue}else return!0;const r=ho[d];let g=o+r,y=!1;for(;g!==t;){if(this._board[g]!=null){y=!0;break}g+=r}if(!y)if(n){i.push(re(o));continue}else return!0}}return n?i:!1}attackers(e,t){return t?this._attacked(t,P[e],!0):this._attacked(this._turn,P[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(gt(e),t)}hash(){return this._hash.toString(16)}isAttacked(e,t){return this._attacked(t,P[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let n=0,i=0;for(let o=P.a8;o<=P.h1;o++){if(i=(i+1)%2,o&136){o+=7;continue}const a=this._board[o];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===Nt&&t.push(i),n++)}if(n===2)return!0;if(n===3&&(e[Nt]===1||e[On]===1))return!0;if(n===e[Nt]+2){let o=0;const a=t.length;for(let l=0;l<a;l++)o+=t[l];if(o===0||o===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:n=void 0}={}){const i=this._moves({square:t,piece:n});return e?i.map(o=>new jt(this,o)):i.map(o=>this._moveToSan(o,i))}_moves({legal:e=!0,piece:t=void 0,square:n=void 0}={}){const i=n?n.toLowerCase():void 0,o=t?.toLowerCase(),a=[],l=this._turn,d=gt(l);let r=P.a8,g=P.h1,y=!1;if(i)if(i in P)r=g=P[i],y=!0;else return[];for(let b=r;b<=g;b++){if(b&136){b+=7;continue}if(!this._board[b]||this._board[b].color===d)continue;const{type:$}=this._board[b];let F;if($===se){if(o&&o!==$)continue;F=b+kn[l][0],this._board[F]||(Ge(a,l,b,F,se),F=b+kn[l][1],yo[l]===Ze(b)&&!this._board[F]&&Ge(a,l,b,F,se,void 0,N.BIG_PAWN));for(let H=2;H<4;H++)F=b+kn[l][H],!(F&136)&&(this._board[F]?.color===d?Ge(a,l,b,F,se,this._board[F].type,N.CAPTURE):F===this._epSquare&&Ge(a,l,b,F,se,se,N.EP_CAPTURE))}else{if(o&&o!==$)continue;for(let H=0,ne=Xn[$].length;H<ne;H++){const S=Xn[$][H];for(F=b;F+=S,!(F&136);){if(!this._board[F])Ge(a,l,b,F,$);else{if(this._board[F].color===l)break;Ge(a,l,b,F,$,this._board[F].type,N.CAPTURE);break}if($===On||$===oe)break}}}}if((o===void 0||o===oe)&&(!y||g===this._kings[l])){if(this._castling[l]&N.KSIDE_CASTLE){const b=this._kings[l],$=b+2;!this._board[b+1]&&!this._board[$]&&!this._attacked(d,this._kings[l])&&!this._attacked(d,b+1)&&!this._attacked(d,$)&&Ge(a,l,this._kings[l],$,oe,void 0,N.KSIDE_CASTLE)}if(this._castling[l]&N.QSIDE_CASTLE){const b=this._kings[l],$=b-2;!this._board[b-1]&&!this._board[b-2]&&!this._board[b-3]&&!this._attacked(d,this._kings[l])&&!this._attacked(d,b-1)&&!this._attacked(d,$)&&Ge(a,l,this._kings[l],$,oe,void 0,N.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return a;const h=[];for(let b=0,$=a.length;b<$;b++)this._makeMove(a[b]),this._isKingAttacked(l)||h.push(a[b]),this._undoMove();return h}move(e,{strict:t=!1}={}){let n=null;if(typeof e=="string")n=this._moveFromSan(e,t);else if(e===null)n=this._moveFromSan(En,t);else if(typeof e=="object"){const o=this._moves();for(let a=0,l=o.length;a<l;a++)if(e.from===re(o[a].from)&&e.to===re(o[a].to)&&(!("promotion"in o[a])||e.promotion===o[a].promotion)){n=o[a];break}}if(!n)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);if(this.isCheck()&&n.flags&N.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new jt(this,n);return this._makeMove(n),this._incPositionCount(),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(e,t){this._hash^=this._pieceKey(e),this._board[t]=this._board[e],delete this._board[e],this._hash^=this._pieceKey(t)}_makeMove(e){const t=this._turn,n=gt(t);if(this._push(e),e.flags&N.NULL_MOVE){t===ye&&this._moveNumber++,this._halfMoves++,this._turn=n,this._epSquare=ae;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),e.captured&&(this._hash^=this._pieceKey(e.to)),this._movePiece(e.from,e.to),e.flags&N.EP_CAPTURE&&(this._turn===ye?this._clear(e.to-16):this._clear(e.to+16)),e.promotion&&(this._clear(e.to),this._set(e.to,{type:e.promotion,color:t})),this._board[e.to].type===oe){if(this._kings[t]=e.to,e.flags&N.KSIDE_CASTLE){const i=e.to-1,o=e.to+1;this._movePiece(o,i)}else if(e.flags&N.QSIDE_CASTLE){const i=e.to+1,o=e.to-2;this._movePiece(o,i)}this._castling[t]=0}if(this._castling[t]){for(let i=0,o=Ke[t].length;i<o;i++)if(e.from===Ke[t][i].square&&this._castling[t]&Ke[t][i].flag){this._castling[t]^=Ke[t][i].flag;break}}if(this._castling[n]){for(let i=0,o=Ke[n].length;i<o;i++)if(e.to===Ke[n][i].square&&this._castling[n]&Ke[n][i].flag){this._castling[n]^=Ke[n][i].flag;break}}if(this._hash^=this._castlingKey(),e.flags&N.BIG_PAWN){let i;t===ye?i=e.to-16:i=e.to+16,!(e.to-1&136)&&this._board[e.to-1]?.type===se&&this._board[e.to-1]?.color===n||!(e.to+1&136)&&this._board[e.to+1]?.type===se&&this._board[e.to+1]?.color===n?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=ae}else this._epSquare=ae;e.piece===se?this._halfMoves=0:e.flags&(N.CAPTURE|N.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===ye&&this._moveNumber++,this._turn=n,this._hash^=bn}undo(){const e=this._hash,t=this._undoMove();if(t){const n=new jt(this,t);return this._decPositionCount(e),n}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=bn;const n=this._turn,i=gt(n);if(t.flags&N.NULL_MOVE)return t;if(this._movePiece(t.to,t.from),t.piece&&(this._clear(t.from),this._set(t.from,{type:t.piece,color:n})),t.captured)if(t.flags&N.EP_CAPTURE){let o;n===ye?o=t.to-16:o=t.to+16,this._set(o,{type:se,color:i})}else this._set(t.to,{type:t.captured,color:i});if(t.flags&(N.KSIDE_CASTLE|N.QSIDE_CASTLE)){let o,a;t.flags&N.KSIDE_CASTLE?(o=t.to+1,a=t.to-1):(o=t.to-2,a=t.to+1),this._movePiece(a,o)}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const n=[];let i=!1;for(const h in this._header)this._header[h]&&n.push(`[${h} "${this._header[h]}"]`+e),i=!0;i&&this._history.length&&n.push(e);const o=h=>{const b=this._comments[this.fen()];if(typeof b<"u"){const $=h.length>0?" ":"";h=`${h}${$}{${b}}`}return h},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let d="";for(a.length===0&&l.push(o(""));a.length>0;){d=o(d);const h=a.pop();if(!h)break;if(!this._history.length&&h.color==="b"){const b=`${this._moveNumber}. ...`;d=d?`${d} ${b}`:b}else h.color==="w"&&(d.length&&l.push(d),d=this._moveNumber+".");d=d+" "+this._moveToSan(h,this._moves({legal:!0})),this._makeMove(h)}if(d.length&&l.push(o(d)),l.push(this._header.Result||"*"),t===0)return n.join("")+l.join(" ");const r=function(){return n.length>0&&n[n.length-1]===" "?(n.pop(),!0):!1},g=function(h,b){for(const $ of b.split(" "))if($){if(h+$.length>t){for(;r();)h--;n.push(e),h=0}n.push($),h+=$.length,n.push(" "),h++}return r()&&h--,h};let y=0;for(let h=0;h<l.length;h++){if(y+l[h].length>t&&l[h].includes("{")){y=g(y,l[h]);continue}y+l[h].length>t&&h!==0?(n[n.length-1]===" "&&n.pop(),n.push(e),y=0):h!==0&&(n.push(" "),y++),n.push(l[h]),y+=l[h].length}return n.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??Dn[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Dn[e]||null,!0):!1}getHeaders(){const e={};for(const[t,n]of Object.entries(this._header))n!==null&&(e[t]=n);return e}loadPgn(e,{strict:t=!1,newlineChar:n=`\r?
`}={}){n!==`\r?
`&&(e=e.replace(new RegExp(n,"g"),`
`));const i=oo(e);this.reset();const o=i.headers;let a="";for(const r in o)r.toLowerCase()==="fen"&&(a=o[r]),this.header(r,o[r]);if(!t)a&&this.load(a,{preserveHeaders:!0});else if(o.SetUp==="1"){if(!("FEN"in o))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(o.FEN,{preserveHeaders:!0})}let l=i.root;for(;l;){if(l.move){const r=this._moveFromSan(l.move,t);if(r==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(r),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const d=i.result;d&&Object.keys(this._header).length&&this._header.Result!==d&&this.setHeader("Result",d)}_moveToSan(e,t){let n="";if(e.flags&N.KSIDE_CASTLE)n="O-O";else if(e.flags&N.QSIDE_CASTLE)n="O-O-O";else{if(e.flags&N.NULL_MOVE)return En;if(e.piece!==se){const i=Eo(e,t);n+=e.piece.toUpperCase()+i}e.flags&(N.CAPTURE|N.EP_CAPTURE)&&(e.piece===se&&(n+=re(e.from)[0]),n+="x"),n+=re(e.to),e.promotion&&(n+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?n+="#":n+="+"),this._undoMove(),n}_moveFromSan(e,t=!1){let n=wn(e);if(t||(n==="0-0"?n="O-O":n==="0-0-0"&&(n="O-O-O")),n==En)return{color:this._turn,from:0,to:0,piece:"k",flags:N.NULL_MOVE};let i=Jn(n),o=this._moves({legal:!0,piece:i});for(let h=0,b=o.length;h<b;h++)if(n===wn(this._moveToSan(o[h],o)))return o[h];if(t)return null;let a,l,d,r,g,y=!1;if(l=n.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],d=l[2],r=l[3],g=l[4],d.length==1&&(y=!0)):(l=n.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],d=l[2],r=l[3],g=l[4],d.length==1&&(y=!0))),i=Jn(n),o=this._moves({legal:!0,piece:a||i}),!r)return null;for(let h=0,b=o.length;h<b;h++)if(d){if((!a||a.toLowerCase()==o[h].piece)&&P[d]==o[h].from&&P[r]==o[h].to&&(!g||g.toLowerCase()==o[h].promotion))return o[h];if(y){const $=re(o[h].from);if((!a||a.toLowerCase()==o[h].piece)&&P[r]==o[h].to&&(d==$[0]||d==$[1])&&(!g||g.toLowerCase()==o[h].promotion))return o[h]}}else if(n===wn(this._moveToSan(o[h],o)).replace("x",""))return o[h];return null}ascii(){let e=`   +------------------------+
`;for(let t=P.a8;t<=P.h1;t++){if(kt(t)===0&&(e+=" "+"87654321"[Ze(t)]+" |"),this._board[t]){const n=this._board[t].type,o=this._board[t].color===de?n.toUpperCase():n.toLowerCase();e+=" "+o+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let n=0;const i=this._turn;for(let o=0,a=t.length;o<a;o++)this._makeMove(t[o]),this._isKingAttacked(i)||(e-1>0?n+=this.perft(e-1):n++),this._undoMove();return n}setTurn(e){return this._turn==e?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const e=[];let t=[];for(let n=P.a8;n<=P.h1;n++)this._board[n]==null?t.push(null):t.push({square:re(n),type:this._board[n].type,color:this._board[n].color}),n+1&136&&(e.push(t),t=[],n+=8);return e}squareColor(e){if(e in P){const t=P[e];return(Ze(t)+kt(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],n=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?n.push(new jt(this,i)):n.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return n}_getPositionCount(e){return this._positionCount.get(e)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(e){const t=this._positionCount.get(e)??0;t===1?this._positionCount.delete(e):this._positionCount.set(e,t-1)}_pruneComments(){const e=[],t={},n=i=>{i in this._comments&&(t[i]=this._comments[i])};for(;this._history.length>0;)e.push(this._undoMove());for(n(this.fen());;){const i=e.pop();if(!i)break;this._makeMove(i),n(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const i of[oe,qe])t[i]!==void 0&&(t[i]?this._castling[e]|=Mt[i]:this._castling[e]&=~Mt[i]);this._updateCastlingRights();const n=this.getCastlingRights(e);return(t[oe]===void 0||t[oe]===n[oe])&&(t[qe]===void 0||t[qe]===n[qe])}getCastlingRights(e){return{[oe]:(this._castling[e]&Mt[oe])!==0,[qe]:(this._castling[e]&Mt[qe])!==0}}moveNumber(){return this._moveNumber}}function Ot(s){if(typeof s!="string"||!s)throw new Error("expected a non-empty string, got: "+s)}function Sn(s){if(typeof s!="number")throw new Error("expected a number, got: "+s)}const wo=1,So=1,et="emoji",ut="keyvalue",Un="favorites",Co="tokens",ms="tokens",To="unicode",vs="count",Io="group",xo="order",gs="group-order",Ln="eTag",Bt="url",es="skinTone",dt="readonly",Kn="readwrite",_s="skinUnicodes",Ao="skinUnicodes",$o="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",jo="en";function Mo(s,e){const t=new Set,n=[];for(const i of s){const o=e(i);t.has(o)||(t.add(o),n.push(i))}return n}function ts(s){return Mo(s,e=>e.unicode)}function Oo(s){function e(t,n,i){const o=n?s.createObjectStore(t,{keyPath:n}):s.createObjectStore(t);if(i)for(const[a,[l,d]]of Object.entries(i))o.createIndex(a,l,{multiEntry:d});return o}e(ut),e(et,To,{[ms]:[Co,!0],[gs]:[[Io,xo]],[_s]:[Ao,!0]}),e(Un,void 0,{[vs]:[""]})}const Nn={},Rt={},Ut={};function bs(s,e,t){t.onerror=()=>e(t.error),t.onblocked=()=>e(new Error("IDB blocked")),t.onsuccess=()=>s(t.result)}async function Do(s){const e=await new Promise((t,n)=>{const i=indexedDB.open(s,wo);Nn[s]=i,i.onupgradeneeded=o=>{o.oldVersion<So&&Oo(i.result)},bs(t,n,i)});return e.onclose=()=>Gn(s),e}function Po(s){return Rt[s]||(Rt[s]=Do(s)),Rt[s]}function Le(s,e,t,n){return new Promise((i,o)=>{const a=s.transaction(e,t,{durability:"relaxed"}),l=typeof e=="string"?a.objectStore(e):e.map(r=>a.objectStore(r));let d;n(l,a,r=>{d=r}),a.oncomplete=()=>i(d),a.onerror=()=>o(a.error)})}function Gn(s){const e=Nn[s],t=e&&e.result;if(t){t.close();const n=Ut[s];if(n)for(const i of n)i()}delete Nn[s],delete Rt[s],delete Ut[s]}function Lo(s){return new Promise((e,t)=>{Gn(s);const n=indexedDB.deleteDatabase(s);bs(e,t,n)})}function No(s,e){let t=Ut[s];t||(t=Ut[s]=[]),t.push(e)}const Ro=new Set([":D","XD",":'D","O:)",":X",":P",";P","XP",":L",":Z",":j","8D","XO","8)",":B",":O",":S",":'o","Dx","X(","D:",":C",">0)",":3","</3","<3","\\M/",":E","8#"]);function lt(s){return s.split(/[\s_]+/).map(e=>!e.match(/\w/)||Ro.has(e)?e.toLowerCase():e.replace(/[)(:,]/g,"").replace(/‚Äô/g,"'").toLowerCase()).filter(Boolean)}const Fo=2;function ys(s){return s.filter(Boolean).map(e=>e.toLowerCase()).filter(e=>e.length>=Fo)}function Bo(s){return s.map(({annotation:t,emoticon:n,group:i,order:o,shortcodes:a,skins:l,tags:d,emoji:r,version:g})=>{const y=[...new Set(ys([...(a||[]).map(lt).flat(),...(d||[]).map(lt).flat(),...lt(t),n]))].sort(),h={annotation:t,group:i,order:o,tags:d,tokens:y,unicode:r,version:g};if(n&&(h.emoticon=n),a&&(h.shortcodes=a),l){h.skinTones=[],h.skinUnicodes=[],h.skinVersions=[];for(const{tone:b,emoji:$,version:F}of l)h.skinTones.push(b),h.skinUnicodes.push($),h.skinVersions.push(F)}return h})}function ks(s,e,t,n){s[e](t).onsuccess=i=>n&&n(i.target.result)}function Je(s,e,t){ks(s,"get",e,t)}function Es(s,e,t){ks(s,"getAll",e,t)}function qn(s){s.commit&&s.commit()}function Uo(s,e){let t=s[0];for(let n=1;n<s.length;n++){const i=s[n];e(t)>e(i)&&(t=i)}return t}function ws(s,e){const t=Uo(s,i=>i.length),n=[];for(const i of t)s.some(o=>o.findIndex(a=>e(a)===e(i))===-1)||n.push(i);return n}async function Ko(s){return!await zn(s,ut,Bt)}async function Go(s,e,t){const[n,i]=await Promise.all([Ln,Bt].map(o=>zn(s,ut,o)));return n===t&&i===e}async function qo(s,e){return Le(s,et,dt,(n,i,o)=>{let a;const l=()=>{n.getAll(a&&IDBKeyRange.lowerBound(a,!0),50).onsuccess=d=>{const r=d.target.result;for(const g of r)if(a=g.unicode,e(g))return o(g);if(r.length<50)return o();l()}};l()})}async function Ss(s,e,t,n){try{const i=Bo(e);await Le(s,[et,ut],Kn,([o,a],l)=>{let d,r,g=0;function y(){++g===2&&h()}function h(){if(!(d===n&&r===t)){o.clear();for(const b of i)o.put(b);a.put(n,Ln),a.put(t,Bt),qn(l)}}Je(a,Ln,b=>{d=b,y()}),Je(a,Bt,b=>{r=b,y()})})}finally{}}async function zo(s,e){return Le(s,et,dt,(t,n,i)=>{const o=IDBKeyRange.bound([e,0],[e+1,0],!1,!0);Es(t.index(gs),o,i)})}async function Cs(s,e){const t=ys(lt(e));return t.length?Le(s,et,dt,(n,i,o)=>{const a=[],l=()=>{a.length===t.length&&d()},d=()=>{const r=ws(a,g=>g.unicode);o(r.sort((g,y)=>g.order<y.order?-1:1))};for(let r=0;r<t.length;r++){const g=t[r],y=r===t.length-1?IDBKeyRange.bound(g,g+"Ôøø",!1,!0):IDBKeyRange.only(g);Es(n.index(ms),y,h=>{a.push(h),l()})}}):[]}async function Ho(s,e){const t=await Cs(s,e);return t.length?t.filter(n=>(n.shortcodes||[]).map(o=>o.toLowerCase()).includes(e.toLowerCase()))[0]||null:await qo(s,i=>(i.shortcodes||[]).includes(e.toLowerCase()))||null}async function Vo(s,e){return Le(s,et,dt,(t,n,i)=>Je(t,e,o=>{if(o)return i(o);Je(t.index(_s),e,a=>i(a||null))}))}function zn(s,e,t){return Le(s,e,dt,(n,i,o)=>Je(n,t,o))}function Wo(s,e,t,n){return Le(s,e,Kn,(i,o)=>{i.put(n,t),qn(o)})}function Qo(s,e){return Le(s,Un,Kn,(t,n)=>Je(t,e,i=>{t.put((i||0)+1,e),qn(n)}))}function Yo(s,e,t){return t===0?[]:Le(s,[Un,et],dt,([n,i],o,a)=>{const l=[];n.index(vs).openCursor(void 0,"prev").onsuccess=d=>{const r=d.target.result;if(!r)return a(l);function g(b){if(l.push(b),l.length===t)return a(l);r.continue()}const y=r.primaryKey,h=e.byName(y);if(h)return g(h);Je(i,y,b=>{if(b)return g(b);r.continue()})}})}const Dt="";function Xo(s,e){const t=new Map;for(const i of s){const o=e(i);for(const a of o){let l=t;for(let r=0;r<a.length;r++){const g=a.charAt(r);let y=l.get(g);y||(y=new Map,l.set(g,y)),l=y}let d=l.get(Dt);d||(d=[],l.set(Dt,d)),d.push(i)}}return(i,o)=>{let a=t;for(let r=0;r<i.length;r++){const g=i.charAt(r),y=a.get(g);if(y)a=y;else return[]}if(o)return a.get(Dt)||[];const l=[],d=[a];for(;d.length;){const g=[...d.shift().entries()].sort((y,h)=>y[0]<h[0]?-1:1);for(const[y,h]of g)y===Dt?l.push(...h):d.push(h)}return l}}const Zo=["name","url"];function Jo(s){const e=s&&Array.isArray(s),t=e&&s.length&&(!s[0]||Zo.some(n=>!(n in s[0])));if(!e||t)throw new Error("Custom emojis are in the wrong format")}function ns(s){Jo(s);const e=(h,b)=>h.name.toLowerCase()<b.name.toLowerCase()?-1:1,t=s.sort(e),i=Xo(s,h=>{const b=new Set;if(h.shortcodes)for(const $ of h.shortcodes)for(const F of lt($))b.add(F);return b}),o=h=>i(h,!0),a=h=>i(h,!1),l=h=>{const b=lt(h),$=b.map((F,H)=>(H<b.length-1?o:a)(F));return ws($,F=>F.name).sort(e)},d=new Map,r=new Map;for(const h of s){r.set(h.name.toLowerCase(),h);for(const b of h.shortcodes||[])d.set(b.toLowerCase(),h)}return{all:t,search:l,byShortcode:h=>d.get(h.toLowerCase()),byName:h=>r.get(h.toLowerCase())}}const ei=typeof wrappedJSObject<"u";function _t(s){if(!s)return s;if(ei&&(s=structuredClone(s)),delete s.tokens,s.skinTones){const e=s.skinTones.length;s.skins=Array(e);for(let t=0;t<e;t++)s.skins[t]={tone:s.skinTones[t],unicode:s.skinUnicodes[t],version:s.skinVersions[t]};delete s.skinTones,delete s.skinUnicodes,delete s.skinVersions}return s}function Ts(s){s||console.warn("emoji-picker-element is more efficient if the dataSource server exposes an ETag header.")}const ti=["annotation","emoji","group","order","version"];function ni(s){if(!s||!Array.isArray(s)||!s[0]||typeof s[0]!="object"||ti.some(e=>!(e in s[0])))throw new Error("Emoji data is in the wrong format")}function Is(s,e){if(Math.floor(s.status/100)!==2)throw new Error("Failed to fetch: "+e+":  "+s.status)}async function si(s){const e=await fetch(s,{method:"HEAD"});Is(e,s);const t=e.headers.get("etag");return Ts(t),t}async function Rn(s){const e=await fetch(s);Is(e,s);const t=e.headers.get("etag");Ts(t);const n=await e.json();return ni(n),[t,n]}function oi(s){for(var e="",t=new Uint8Array(s),n=t.byteLength,i=-1;++i<n;)e+=String.fromCharCode(t[i]);return e}function ii(s){for(var e=s.length,t=new ArrayBuffer(e),n=new Uint8Array(t),i=-1;++i<e;)n[i]=s.charCodeAt(i);return t}async function xs(s){const e=JSON.stringify(s);let t=ii(e);const n=await crypto.subtle.digest("SHA-1",t),i=oi(n);return btoa(i)}async function ri(s,e){let t,n=await si(e);if(!n){const i=await Rn(e);n=i[0],t=i[1],n||(n=await xs(t))}await Go(s,e,n)||(t||(t=(await Rn(e))[1]),await Ss(s,t,e,n))}async function ai(s,e){let[t,n]=await Rn(e);t||(t=await xs(n)),await Ss(s,n,e,t)}async function li(s,e){try{await ri(s,e)}catch(t){if(t.name!=="InvalidStateError")throw t}}class ci{constructor({dataSource:e=$o,locale:t=jo,customEmoji:n=[]}={}){this.dataSource=e,this.locale=t,this._dbName=`emoji-picker-element-${this.locale}`,this._db=void 0,this._lazyUpdate=void 0,this._custom=ns(n),this._clear=this._clear.bind(this),this._ready=this._init()}async _init(){const e=this._db=await Po(this._dbName);No(this._dbName,this._clear);const t=this.dataSource;await Ko(e)?await ai(e,t):this._lazyUpdate=li(e,t)}async ready(){const e=async()=>(this._ready||(this._ready=this._init()),this._ready);await e(),this._db||await e()}async getEmojiByGroup(e){return Sn(e),await this.ready(),ts(await zo(this._db,e)).map(_t)}async getEmojiBySearchQuery(e){Ot(e),await this.ready();const t=this._custom.search(e),n=ts(await Cs(this._db,e)).map(_t);return[...t,...n]}async getEmojiByShortcode(e){Ot(e),await this.ready();const t=this._custom.byShortcode(e);return t||_t(await Ho(this._db,e))}async getEmojiByUnicodeOrName(e){Ot(e),await this.ready();const t=this._custom.byName(e);return t||_t(await Vo(this._db,e))}async getPreferredSkinTone(){return await this.ready(),await zn(this._db,ut,es)||0}async setPreferredSkinTone(e){return Sn(e),await this.ready(),Wo(this._db,ut,es,e)}async incrementFavoriteEmojiCount(e){return Ot(e),await this.ready(),Qo(this._db,e)}async getTopFavoriteEmoji(e){return Sn(e),await this.ready(),(await Yo(this._db,this._custom,e)).map(_t)}set customEmoji(e){this._custom=ns(e)}get customEmoji(){return this._custom.all}async _shutdown(){await this.ready();try{await this._lazyUpdate}catch{}}_clear(){this._db=this._ready=this._lazyUpdate=void 0}async close(){await this._shutdown(),await Gn(this._dbName)}async delete(){await this._shutdown(),await Lo(this._dbName)}}const Fn=[[-1,"‚ú®","custom"],[0,"üòÄ","smileys-emotion"],[1,"üëã","people-body"],[3,"üê±","animals-nature"],[4,"üçé","food-drink"],[5,"üè†Ô∏è","travel-places"],[6,"‚öΩ","activities"],[7,"üìù","objects"],[8,"‚õîÔ∏è","symbols"],[9,"üèÅ","flags"]].map(([s,e,t])=>({id:s,emoji:e,name:t})),Cn=Fn.slice(1),ui=2,ss=6,As=typeof requestIdleCallback=="function"?requestIdleCallback:setTimeout;function os(s){return s.unicode.includes("‚Äç")}const di={"ü´™":17,"ü´©":16,"ü´®":15.1,"ü´†":14,"ü•≤":13.1,"ü•ª":12.1,"ü•∞":11,"ü§©":5,"üë±‚Äç‚ôÄÔ∏è":4,"ü§£":3,"üëÅÔ∏è‚Äçüó®Ô∏è":2,"üòÄ":1,"üòêÔ∏è":.7,"üòÉ":.6},fi=1e3,hi="üñêÔ∏è",pi=8,mi=["üòä","üòí","‚ù§Ô∏è","üëçÔ∏è","üòç","üòÇ","üò≠","‚ò∫Ô∏è","üòî","üò©","üòè","üíï","üôå","üòò"],$s='"Twemoji Mozilla","Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji","EmojiOne Color","Android Emoji",sans-serif',vi=(s,e)=>s<e?-1:s>e?1:0,is=(s,e)=>{const t=document.createElement("canvas");t.width=t.height=1;const n=t.getContext("2d",{willReadFrequently:!0});return n.textBaseline="top",n.font=`100px ${$s}`,n.fillStyle=e,n.scale(.01,.01),n.fillText(s,0,0),n.getImageData(0,0,1,1).data},gi=(s,e)=>{const t=[...s].join(","),n=[...e].join(",");return t===n&&!t.startsWith("0,0,0,")};function _i(s){const e=is(s,"#000"),t=is(s,"#fff");return e&&t&&gi(e,t)}function bi(){const s=Object.entries(di);try{for(const[e,t]of s)if(_i(e))return t}catch{}finally{}return s[0][1]}let Tn;const In=()=>(Tn||(Tn=new Promise(s=>As(()=>s(bi())))),Tn),Bn=new Map,yi="Ô∏è",ki="\uD83C",Ei="‚Äç",wi=127995,Si=57339;function Ci(s,e){if(e===0)return s;const t=s.indexOf(Ei);return t!==-1?s.substring(0,t)+String.fromCodePoint(wi+e-1)+s.substring(t):(s.endsWith(yi)&&(s=s.substring(0,s.length-1)),s+ki+String.fromCodePoint(Si+e-1))}function $e(s){s.preventDefault(),s.stopPropagation()}function xn(s,e,t){return e+=s?-1:1,e<0?e=t.length-1:e>=t.length&&(e=0),e}function js(s,e){const t=new Set,n=[];for(const i of s){const o=e(i);t.has(o)||(t.add(o),n.push(i))}return n}function Ti(s,e){const t=n=>{const i={};for(const o of n)typeof o.tone=="number"&&o.version<=e&&(i[o.tone]=o.unicode);return i};return s.map(({unicode:n,skins:i,shortcodes:o,url:a,name:l,category:d,annotation:r})=>({unicode:n,name:l,shortcodes:o,url:a,category:d,annotation:r,id:n||l,skins:i&&t(i)}))}const Ft=requestAnimationFrame;let Ii=typeof ResizeObserver=="function";function xi(s,e,t){let n;Ii?(n=new ResizeObserver(t),n.observe(s)):Ft(t),e.addEventListener("abort",()=>{n&&n.disconnect()})}function rs(s){{const e=document.createRange();return e.selectNode(s.firstChild),e.getBoundingClientRect().width}}let An;function Ai(s,e,t){let n=!0;for(const i of s){const o=t(i);if(!o)continue;const a=rs(o);typeof An>"u"&&(An=rs(e));const l=a/1.8<An;Bn.set(i.unicode,l),l||(n=!1)}return n}function $i(s){return js(s,e=>e)}function ji(s){s&&(s.scrollTop=0)}function yt(s,e,t){let n=s.get(e);return n||(n=t(),s.set(e,n)),n}function as(s){return""+s}function Mi(s){const e=document.createElement("template");return e.innerHTML=s,e}const Oi=new WeakMap,Di=new WeakMap,Pi=Symbol("un-keyed"),Li="replaceChildren"in Element.prototype;function Ni(s,e){Li?s.replaceChildren(...e):(s.innerHTML="",s.append(...e))}function Ri(s,e){let t=s.firstChild,n=0;for(;t;){if(e[n]!==t)return!0;t=t.nextSibling,n++}return n!==e.length}function Fi(s,e){const{targetNode:t}=e;let{targetParentNode:n}=e,i=!1;n?i=Ri(n,s):(i=!0,e.targetNode=void 0,e.targetParentNode=n=t.parentNode),i&&Ni(n,s)}function Bi(s,e){for(const t of e){const{targetNode:n,currentExpression:i,binding:{expressionIndex:o,attributeName:a,attributeValuePre:l,attributeValuePost:d}}=t,r=s[o];if(i!==r)if(t.currentExpression=r,a)if(r===null)n.removeAttribute(a);else{const g=l+as(r)+d;n.setAttribute(a,g)}else{let g;Array.isArray(r)?Fi(r,t):r instanceof Element?(g=r,n.replaceWith(g)):n.nodeValue=as(r),g&&(t.targetNode=g)}}}function Ui(s){let e="",t=!1,n=!1,i=-1;const o=new Map,a=[];let l=0;for(let r=0,g=s.length;r<g;r++){const y=s[r];if(e+=y.slice(l),r===g-1)break;for(let S=0;S<y.length;S++)switch(y.charAt(S)){case"<":{y.charAt(S+1)==="/"?a.pop():(t=!0,a.push(++i));break}case">":{t=!1,n=!1;break}case"=":{n=!0;break}}const h=a[a.length-1],b=yt(o,h,()=>[]);let $,F,H;if(n){const S=/(\S+)="?([^"=]*)$/.exec(y);$=S[1],F=S[2];const K=/^([^">]*)("?)/.exec(s[r+1]);H=K[1],e=e.slice(0,-1*S[0].length),l=K[0].length}else l=0;const ne={attributeName:$,attributeValuePre:F,attributeValuePost:H,expressionIndex:r};b.push(ne),!t&&!n&&(e+=" ")}return{template:Mi(e),elementsToBindings:o}}function ls(s,e,t){for(let n=0;n<s.length;n++){const i=s[n],o=i.attributeName?e:e.firstChild,a={binding:i,targetNode:o,targetParentNode:void 0,currentExpression:void 0};t.push(a)}}function Ki(s,e){const t=[];let n;if(e.size===1&&(n=e.get(0)))ls(n,s,t);else{const i=document.createTreeWalker(s,NodeFilter.SHOW_ELEMENT);let o=s,a=-1;do{const l=e.get(++a);l&&ls(l,o,t)}while(o=i.nextNode())}return t}function Gi(s){const{template:e,elementsToBindings:t}=yt(Oi,s,()=>Ui(s)),n=e.cloneNode(!0).content.firstElementChild,i=Ki(n,t);return function(a){return Bi(a,i),n}}function qi(s){const e=yt(Di,s,()=>new Map);let t=Pi;function n(o,...a){const l=yt(e,o,()=>new Map);return yt(l,t,()=>Gi(o))(a)}function i(o,a,l){return o.map((d,r)=>{const g=t;t=l(d);try{return a(d,r)}finally{t=g}})}return{map:i,html:n}}function zi(s,e,t,n,i,o,a,l,d){const{labelWithSkin:r,titleForEmoji:g,unicodeWithSkin:y}=t,{html:h,map:b}=qi(e);function $(S,K,Z){return b(S,(V,J)=>h`<button role="${K?"option":"menuitem"}" aria-selected="${K?J===e.activeSearchItem:null}" aria-label="${r(V,e.currentSkinTone)}" title="${g(V)}" class="${"emoji"+(K&&J===e.activeSearchItem?" active":"")+(V.unicode?"":" custom-emoji")}" id="${`${Z}-${V.id}`}" style="${V.unicode?null:`--custom-emoji-background: url(${JSON.stringify(V.url)})`}">${V.unicode?y(V,e.currentSkinTone):""}</button>`,V=>`${Z}-${V.id}`)}const H=h`<section data-ref="rootElement" class="picker" aria-label="${e.i18n.regionLabel}" style="${e.pickerStyle||""}"><div class="pad-top"></div><div class="search-row"><div class="search-wrapper"><input id="search" class="search" type="search" role="combobox" enterkeyhint="search" placeholder="${e.i18n.searchLabel}" autocapitalize="none" autocomplete="off" spellcheck="true" aria-expanded="${!!(e.searchMode&&e.currentEmojis.length)}" aria-controls="search-results" aria-describedby="search-description" aria-autocomplete="list" aria-activedescendant="${e.activeSearchItemId?`emo-${e.activeSearchItemId}`:null}" data-ref="searchElement" data-on-input="onSearchInput" data-on-keydown="onSearchKeydown"><label class="sr-only" for="search">${e.i18n.searchLabel}</label> <span id="search-description" class="sr-only">${e.i18n.searchDescription}</span></div><div class="skintone-button-wrapper ${e.skinTonePickerExpandedAfterAnimation?"expanded":""}"><button id="skintone-button" class="emoji ${e.skinTonePickerExpanded?"hide-focus":""}" aria-label="${e.skinToneButtonLabel}" title="${e.skinToneButtonLabel}" aria-describedby="skintone-description" aria-haspopup="listbox" aria-expanded="${e.skinTonePickerExpanded}" aria-controls="skintone-list" data-on-click="onClickSkinToneButton">${e.skinToneButtonText||""}</button></div><span id="skintone-description" class="sr-only">${e.i18n.skinToneDescription}</span><div data-ref="skinToneDropdown" id="skintone-list" class="skintone-list hide-focus ${e.skinTonePickerExpanded?"":"hidden no-animate"}" style="transform:translateY(${e.skinTonePickerExpanded?0:"calc(-1 * var(--num-skintones) * var(--total-emoji-size))"})" role="listbox" aria-label="${e.i18n.skinTonesLabel}" aria-activedescendant="skintone-${e.activeSkinTone}" aria-hidden="${!e.skinTonePickerExpanded}" tabIndex="-1" data-on-focusout="onSkinToneOptionsFocusOut" data-on-click="onSkinToneOptionsClick" data-on-keydown="onSkinToneOptionsKeydown" data-on-keyup="onSkinToneOptionsKeyup">${b(e.skinTones,(S,K)=>h`<div id="skintone-${K}" class="emoji ${K===e.activeSkinTone?"active":""}" aria-selected="${K===e.activeSkinTone}" role="option" title="${e.i18n.skinTones[K]}" aria-label="${e.i18n.skinTones[K]}">${S}</div>`,S=>S)}</div></div><div class="nav" role="tablist" style="grid-template-columns:repeat(${e.groups.length},1fr)" aria-label="${e.i18n.categoriesLabel}" data-on-keydown="onNavKeydown" data-on-click="onNavClick">${b(e.groups,S=>h`<button role="tab" class="nav-button" aria-controls="tab-${S.id}" aria-label="${e.i18n.categories[S.name]}" aria-selected="${!e.searchMode&&e.currentGroup.id===S.id}" title="${e.i18n.categories[S.name]}" data-group-id="${S.id}"><div class="nav-emoji emoji">${S.emoji}</div></button>`,S=>S.id)}</div><div class="indicator-wrapper"><div class="indicator" style="transform:translateX(${(e.isRtl?-1:1)*e.currentGroupIndex*100}%)"></div></div><div class="message ${e.message?"":"gone"}" role="alert" aria-live="polite">${e.message||""}</div><div data-ref="tabpanelElement" class="tabpanel ${!e.databaseLoaded||e.message?"gone":""}" role="${e.searchMode?"region":"tabpanel"}" aria-label="${e.searchMode?e.i18n.searchResultsLabel:e.i18n.categories[e.currentGroup.name]}" id="${e.searchMode?null:`tab-${e.currentGroup.id}`}" tabIndex="0" data-on-click="onEmojiClick"><div data-action="calculateEmojiGridStyle">${b(e.currentEmojisWithCategories,(S,K)=>h`<div><div id="menu-label-${K}" class="category ${e.currentEmojisWithCategories.length===1&&e.currentEmojisWithCategories[0].category===""?"gone":""}" aria-hidden="true">${e.searchMode?e.i18n.searchResultsLabel:S.category?S.category:e.currentEmojisWithCategories.length>1?e.i18n.categories.custom:e.i18n.categories[e.currentGroup.name]}</div><div class="emoji-menu ${K!==0&&!e.searchMode&&e.currentGroup.id===-1?"visibility-auto":""}" style="${`--num-rows: ${Math.ceil(S.emojis.length/e.numColumns)}`}" data-action="updateOnIntersection" role="${e.searchMode?"listbox":"menu"}" aria-labelledby="menu-label-${K}" id="${e.searchMode?"search-results":null}">${$(S.emojis,e.searchMode,"emo")}</div></div>`,S=>S.category)}</div></div><div class="favorites onscreen emoji-menu ${e.message?"gone":""}" role="menu" aria-label="${e.i18n.favoritesLabel}" data-on-click="onEmojiClick">${$(e.currentFavorites,!1,"fav")}</div><button data-ref="baselineEmoji" aria-hidden="true" tabindex="-1" class="abs-pos hidden emoji baseline-emoji">üòÄ</button></section>`,ne=(S,K)=>{for(const Z of s.querySelectorAll(`[${S}]`))K(Z,Z.getAttribute(S))};if(d){s.appendChild(H);for(const S of["click","focusout","input","keydown","keyup"])ne(`data-on-${S}`,(K,Z)=>{K.addEventListener(S,n[Z])});ne("data-ref",(S,K)=>{o[K]=S}),a.addEventListener("abort",()=>{s.removeChild(H)})}ne("data-action",(S,K)=>{let Z=l.get(K);Z||l.set(K,Z=new WeakSet),Z.has(S)||(Z.add(S),i[K](S))})}const Kt=typeof queueMicrotask=="function"?queueMicrotask:s=>Promise.resolve().then(s);function Hi(s){let e=!1,t;const n=new Map,i=new Set;let o;const a=()=>{if(e)return;const r=[...i];i.clear();try{for(const g of r)g()}finally{o=!1,i.size&&(o=!0,Kt(a))}},l=new Proxy({},{get(r,g){if(t){let y=n.get(g);y||(y=new Set,n.set(g,y)),y.add(t)}return r[g]},set(r,g,y){if(r[g]!==y){r[g]=y;const h=n.get(g);if(h){for(const b of h)i.add(b);o||(o=!0,Kt(a))}}return!0}}),d=r=>{const g=()=>{const y=t;t=g;try{return r()}finally{t=y}};return g()};return s.addEventListener("abort",()=>{e=!0}),{state:l,createEffect:d}}function $n(s,e,t){if(s.length!==e.length)return!1;for(let n=0;n<s.length;n++)if(!t(s[n],e[n]))return!1;return!0}const cs=new WeakMap;function Vi(s,e,t){{const n=s.closest(".tabpanel");let i=cs.get(n);i||(i=new IntersectionObserver(t,{root:n,rootMargin:"50% 0px 50% 0px",threshold:0}),cs.set(n,i),e.addEventListener("abort",()=>{i.disconnect()})),i.observe(s)}}const jn=[],{assign:Pt}=Object;function Wi(s,e){const t={},n=new AbortController,i=n.signal,{state:o,createEffect:a}=Hi(i),l=new Map;Pt(o,{skinToneEmoji:void 0,i18n:void 0,database:void 0,customEmoji:void 0,customCategorySorting:void 0,emojiVersion:void 0}),Pt(o,e),Pt(o,{initialLoad:!0,currentEmojis:[],currentEmojisWithCategories:[],rawSearchText:"",searchText:"",searchMode:!1,activeSearchItem:-1,message:void 0,skinTonePickerExpanded:!1,skinTonePickerExpandedAfterAnimation:!1,currentSkinTone:0,activeSkinTone:0,skinToneButtonText:void 0,pickerStyle:void 0,skinToneButtonLabel:"",skinTones:[],currentFavorites:[],defaultFavoriteEmojis:void 0,numColumns:pi,isRtl:!1,currentGroupIndex:0,groups:Cn,databaseLoaded:!1,activeSearchItemId:void 0}),a(()=>{o.currentGroup!==o.groups[o.currentGroupIndex]&&(o.currentGroup=o.groups[o.currentGroupIndex])});const d=_=>{s.getElementById(_).focus()},r=_=>s.getElementById(`emo-${_.id}`),g=(_,E)=>{t.rootElement.dispatchEvent(new CustomEvent(_,{detail:E,bubbles:!0,composed:!0}))},y=(_,E)=>_.id===E.id,h=(_,E)=>{const{category:M,emojis:B}=_,{category:ee,emojis:te}=E;return M!==ee?!1:$n(B,te,y)},b=_=>{$n(o.currentEmojis,_,y)||(o.currentEmojis=_)},$=_=>{o.searchMode!==_&&(o.searchMode=_)},F=_=>{$n(o.currentEmojisWithCategories,_,h)||(o.currentEmojisWithCategories=_)},H=(_,E)=>E&&_.skins&&_.skins[E]||_.unicode,K={labelWithSkin:(_,E)=>$i([_.name||H(_,E),_.annotation,..._.shortcodes||jn].filter(Boolean)).join(", "),titleForEmoji:_=>_.annotation||(_.shortcodes||jn).join(", "),unicodeWithSkin:H},Z={onClickSkinToneButton:He,onEmojiClick:ke,onNavClick:Me,onNavKeydown:ze,onSearchKeydown:pe,onSkinToneOptionsClick:tt,onSkinToneOptionsFocusOut:Fe,onSkinToneOptionsKeydown:Te,onSkinToneOptionsKeyup:Ie,onSearchInput:Ve},V={calculateEmojiGridStyle:T,updateOnIntersection:j};let J=!0;a(()=>{zi(s,o,K,Z,V,t,i,l,J),J=!1}),o.emojiVersion||In().then(_=>{_||(o.message=o.i18n.emojiUnsupportedMessage)}),a(()=>{async function _(){let E=!1;const M=setTimeout(()=>{E=!0,o.message=o.i18n.loadingMessage},fi);try{await o.database.ready(),o.databaseLoaded=!0}catch(B){console.error(B),o.message=o.i18n.networkErrorMessage}finally{clearTimeout(M),E&&(E=!1,o.message="")}}o.database&&_()}),a(()=>{o.pickerStyle=`
      --num-groups: ${o.groups.length}; 
      --indicator-opacity: ${o.searchMode?0:1}; 
      --num-skintones: ${ss};`}),a(()=>{o.customEmoji&&o.database&&he()}),a(()=>{o.customEmoji&&o.customEmoji.length?o.groups!==Fn&&(o.groups=Fn):o.groups!==Cn&&(o.currentGroupIndex&&o.currentGroupIndex--,o.groups=Cn)}),a(()=>{async function _(){o.databaseLoaded&&(o.currentSkinTone=await o.database.getPreferredSkinTone())}_()}),a(()=>{o.skinTones=Array(ss).fill().map((_,E)=>Ci(o.skinToneEmoji,E))}),a(()=>{o.skinToneButtonText=o.skinTones[o.currentSkinTone]}),a(()=>{o.skinToneButtonLabel=o.i18n.skinToneLabel.replace("{skinTone}",o.i18n.skinTones[o.currentSkinTone])}),a(()=>{async function _(){const{database:E}=o,M=(await Promise.all(mi.map(B=>E.getEmojiByUnicodeOrName(B)))).filter(Boolean);o.defaultFavoriteEmojis=M}o.databaseLoaded&&_()});function he(){const{customEmoji:_,database:E}=o,M=_||jn;E.customEmoji!==M&&(E.customEmoji=M)}a(()=>{async function _(){he();const{database:E,defaultFavoriteEmojis:M,numColumns:B}=o,ee=await E.getTopFavoriteEmoji(B),te=await ge(js([...ee,...M],fe=>fe.unicode||fe.name).slice(0,B));o.currentFavorites=te}o.databaseLoaded&&o.defaultFavoriteEmojis&&_()});function T(_){xi(_,i,()=>{{const E=getComputedStyle(t.rootElement),M=parseInt(E.getPropertyValue("--num-columns"),10),B=E.getPropertyValue("direction")==="rtl";o.numColumns=M,o.isRtl=B}})}function j(_){Vi(_,i,E=>{for(const{target:M,isIntersecting:B}of E)M.classList.toggle("onscreen",B)})}a(()=>{async function _(){const{searchText:E,currentGroup:M,databaseLoaded:B,customEmoji:ee}=o;if(!B)o.currentEmojis=[],o.searchMode=!1;else if(E.length>=ui){const te=await je(E);o.searchText===E&&(b(te),$(!0))}else{const{id:te}=M;if(te!==-1||ee&&ee.length){const fe=await Ne(te);o.currentGroup.id===te&&(b(fe),$(!1))}}}_()});const R=()=>{Ft(()=>ji(t.tabpanelElement))};a(()=>{const{currentEmojis:_,emojiVersion:E}=o,M=_.filter(B=>B.unicode).filter(B=>os(B)&&!Bn.has(B.unicode));if(!E&&M.length)b(_),Ft(()=>G(M));else{const B=E?_:_.filter(Y);b(B),R()}});function G(_){Ai(_,t.baselineEmoji,r)?R():o.currentEmojis=[...o.currentEmojis]}function Y(_){return!_.unicode||!os(_)||Bn.get(_.unicode)}async function ie(_){const E=o.emojiVersion||await In();return _.filter(({version:M})=>!M||M<=E)}async function ge(_){return Ti(_,o.emojiVersion||await In())}async function Ne(_){const E=_===-1?o.customEmoji:await o.database.getEmojiByGroup(_);return ge(await ie(E))}async function je(_){return ge(await ie(await o.database.getEmojiBySearchQuery(_)))}a(()=>{}),a(()=>{function _(){const{searchMode:M,currentEmojis:B}=o;if(M)return[{category:"",emojis:B}];const ee=new Map;for(const te of B){const fe=te.category||"";let Be=ee.get(fe);Be||(Be=[],ee.set(fe,Be)),Be.push(te)}return[...ee.entries()].map(([te,fe])=>({category:te,emojis:fe})).sort((te,fe)=>o.customCategorySorting(te.category,fe.category))}const E=_();F(E)}),a(()=>{o.activeSearchItemId=o.activeSearchItem!==-1&&o.currentEmojis[o.activeSearchItem].id}),a(()=>{const{rawSearchText:_}=o;As(()=>{o.searchText=(_||"").trim(),o.activeSearchItem=-1})});function pe(_){if(!o.searchMode||!o.currentEmojis.length)return;const E=M=>{$e(_),o.activeSearchItem=xn(M,o.activeSearchItem,o.currentEmojis)};switch(_.key){case"ArrowDown":return E(!1);case"ArrowUp":return E(!0);case"Enter":if(o.activeSearchItem===-1)o.activeSearchItem=0;else return $e(_),xe(o.currentEmojis[o.activeSearchItem].id)}}function Me(_){const{target:E}=_,M=E.closest(".nav-button");if(!M)return;const B=parseInt(M.dataset.groupId,10);t.searchElement.value="",o.rawSearchText="",o.searchText="",o.activeSearchItem=-1,o.currentGroupIndex=o.groups.findIndex(ee=>ee.id===B)}function ze(_){const{target:E,key:M}=_,B=ee=>{ee&&($e(_),ee.focus())};switch(M){case"ArrowLeft":return B(E.previousElementSibling);case"ArrowRight":return B(E.nextElementSibling);case"Home":return B(E.parentElement.firstElementChild);case"End":return B(E.parentElement.lastElementChild)}}async function Re(_){const E=await o.database.getEmojiByUnicodeOrName(_),M=[...o.currentEmojis,...o.currentFavorites].find(ee=>ee.id===_),B=M.unicode&&H(M,o.currentSkinTone);return await o.database.incrementFavoriteEmojiCount(_),{emoji:E,skinTone:o.currentSkinTone,...B&&{unicode:B},...M.name&&{name:M.name}}}async function xe(_){const E=Re(_);g("emoji-click-sync",E),g("emoji-click",await E)}function ke(_){const{target:E}=_;if(!E.classList.contains("emoji"))return;$e(_);const M=E.id.substring(4);xe(M)}function Ce(_){o.currentSkinTone=_,o.skinTonePickerExpanded=!1,d("skintone-button"),g("skin-tone-change",{skinTone:_}),o.database.setPreferredSkinTone(_)}function tt(_){const{target:{id:E}}=_,M=E&&E.match(/^skintone-(\d)/);if(!M)return;$e(_);const B=parseInt(M[1],10);Ce(B)}function He(_){o.skinTonePickerExpanded=!o.skinTonePickerExpanded,o.activeSkinTone=o.currentSkinTone,o.skinTonePickerExpanded&&($e(_),Ft(()=>d("skintone-list")))}a(()=>{o.skinTonePickerExpanded?t.skinToneDropdown.addEventListener("transitionend",()=>{o.skinTonePickerExpandedAfterAnimation=!0},{once:!0}):o.skinTonePickerExpandedAfterAnimation=!1});function Te(_){if(!o.skinTonePickerExpanded)return;const E=async M=>{$e(_),o.activeSkinTone=M};switch(_.key){case"ArrowUp":return E(xn(!0,o.activeSkinTone,o.skinTones));case"ArrowDown":return E(xn(!1,o.activeSkinTone,o.skinTones));case"Home":return E(0);case"End":return E(o.skinTones.length-1);case"Enter":return $e(_),Ce(o.activeSkinTone);case"Escape":return $e(_),o.skinTonePickerExpanded=!1,d("skintone-button")}}function Ie(_){if(o.skinTonePickerExpanded)switch(_.key){case" ":return $e(_),Ce(o.activeSkinTone)}}async function Fe(_){const{relatedTarget:E}=_;(!E||E.id!=="skintone-list")&&(o.skinTonePickerExpanded=!1)}function Ve(_){o.rawSearchText=_.target.value}return{$set(_){Pt(o,_)},$destroy(){n.abort()}}}const Qi="https://cdn.jsdelivr.net/npm/emoji-picker-element-data@^1/en/emojibase/data.json",Yi="en";var Xi={categoriesLabel:"Categories",emojiUnsupportedMessage:"Your browser does not support color emoji.",favoritesLabel:"Favorites",loadingMessage:"Loading‚Ä¶",networkErrorMessage:"Could not load emoji.",regionLabel:"Emoji picker",searchDescription:"When search results are available, press up or down to select and enter to choose.",searchLabel:"Search",searchResultsLabel:"Search results",skinToneDescription:"When expanded, press up or down to select and enter to choose.",skinToneLabel:"Choose a skin tone (currently {skinTone})",skinTonesLabel:"Skin tones",skinTones:["Default","Light","Medium-Light","Medium","Medium-Dark","Dark"],categories:{custom:"Custom","smileys-emotion":"Smileys and emoticons","people-body":"People and body","animals-nature":"Animals and nature","food-drink":"Food and drink","travel-places":"Travel and places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"}},Zi=':host{--emoji-size:1.375rem;--emoji-padding:0.5rem;--category-emoji-size:var(--emoji-size);--category-emoji-padding:var(--emoji-padding);--indicator-height:3px;--input-border-radius:0.5rem;--input-border-size:1px;--input-font-size:1rem;--input-line-height:1.5;--input-padding:0.25rem;--num-columns:8;--outline-size:2px;--border-size:1px;--border-radius:0;--skintone-border-radius:1rem;--category-font-size:1rem;display:flex;width:min-content;height:400px}:host,:host(.light){color-scheme:light;--background:#fff;--border-color:#e0e0e0;--indicator-color:#385ac1;--input-border-color:#999;--input-font-color:#111;--input-placeholder-color:#999;--outline-color:#999;--category-font-color:#111;--button-active-background:#e6e6e6;--button-hover-background:#d9d9d9}:host(.dark){color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}@media (prefers-color-scheme:dark){:host{color-scheme:dark;--background:#222;--border-color:#444;--indicator-color:#5373ec;--input-border-color:#ccc;--input-font-color:#efefef;--input-placeholder-color:#ccc;--outline-color:#fff;--category-font-color:#efefef;--button-active-background:#555555;--button-hover-background:#484848}}:host([hidden]){display:none}button{margin:0;padding:0;border:0;background:0 0;box-shadow:none;-webkit-tap-highlight-color:transparent}button::-moz-focus-inner{border:0}input{padding:0;margin:0;line-height:1.15;font-family:inherit}input[type=search]{-webkit-appearance:none}:focus{outline:var(--outline-color) solid var(--outline-size);outline-offset:calc(-1*var(--outline-size))}:host([data-js-focus-visible]) :focus:not([data-focus-visible-added]){outline:0}:focus:not(:focus-visible){outline:0}.hide-focus{outline:0}*{box-sizing:border-box}.picker{contain:content;display:flex;flex-direction:column;background:var(--background);border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);width:100%;height:100%;overflow:hidden;--total-emoji-size:calc(var(--emoji-size) + (2 * var(--emoji-padding)));--total-category-emoji-size:calc(var(--category-emoji-size) + (2 * var(--category-emoji-padding)))}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.hidden{opacity:0;pointer-events:none}.abs-pos{position:absolute;left:0;top:0}.gone{display:none!important}.skintone-button-wrapper,.skintone-list{background:var(--background);z-index:3}.skintone-button-wrapper.expanded{z-index:1}.skintone-list{position:absolute;inset-inline-end:0;top:0;z-index:2;overflow:visible;border-bottom:var(--border-size) solid var(--border-color);border-radius:0 0 var(--skintone-border-radius) var(--skintone-border-radius);will-change:transform;transition:transform .2s ease-in-out;transform-origin:center 0}@media (prefers-reduced-motion:reduce){.skintone-list{transition-duration:.001s}}@supports not (inset-inline-end:0){.skintone-list{right:0}}.skintone-list.no-animate{transition:none}.tabpanel{overflow-y:auto;scrollbar-gutter:stable;-webkit-overflow-scrolling:touch;will-change:transform;min-height:0;flex:1;contain:content}.emoji-menu{display:grid;grid-template-columns:repeat(var(--num-columns),var(--total-emoji-size));justify-content:space-around;align-items:flex-start;width:100%}.emoji-menu.visibility-auto{content-visibility:auto;contain-intrinsic-size:calc(var(--num-columns)*var(--total-emoji-size)) calc(var(--num-rows)*var(--total-emoji-size))}.category{padding:var(--emoji-padding);font-size:var(--category-font-size);color:var(--category-font-color)}.emoji,button.emoji{font-size:var(--emoji-size);display:flex;align-items:center;justify-content:center;border-radius:100%;height:var(--total-emoji-size);width:var(--total-emoji-size);line-height:1;overflow:hidden;font-family:var(--emoji-font-family);cursor:pointer}@media (hover:hover) and (pointer:fine){.emoji:hover,button.emoji:hover{background:var(--button-hover-background)}}.emoji.active,.emoji:active,button.emoji.active,button.emoji:active{background:var(--button-active-background)}.onscreen .custom-emoji::after{content:"";width:var(--emoji-size);height:var(--emoji-size);background-repeat:no-repeat;background-position:center center;background-size:contain;background-image:var(--custom-emoji-background)}.nav,.nav-button{align-items:center}.nav{display:grid;justify-content:space-between;contain:content}.nav-button{display:flex;justify-content:center}.nav-emoji{font-size:var(--category-emoji-size);width:var(--total-category-emoji-size);height:var(--total-category-emoji-size)}.indicator-wrapper{display:flex;border-bottom:1px solid var(--border-color)}.indicator{width:calc(100%/var(--num-groups));height:var(--indicator-height);opacity:var(--indicator-opacity);background-color:var(--indicator-color);will-change:transform,opacity;transition:opacity .1s linear,transform .25s ease-in-out}@media (prefers-reduced-motion:reduce){.indicator{will-change:opacity;transition:opacity .1s linear}}.pad-top,input.search{background:var(--background);width:100%}.pad-top{height:var(--emoji-padding);z-index:3}.search-row{display:flex;align-items:center;position:relative;padding-inline-start:var(--emoji-padding);padding-bottom:var(--emoji-padding)}.search-wrapper{flex:1;min-width:0}input.search{padding:var(--input-padding);border-radius:var(--input-border-radius);border:var(--input-border-size) solid var(--input-border-color);color:var(--input-font-color);font-size:var(--input-font-size);line-height:var(--input-line-height)}input.search::placeholder{color:var(--input-placeholder-color)}.favorites{overflow-y:auto;scrollbar-gutter:stable;display:flex;flex-direction:row;border-top:var(--border-size) solid var(--border-color);contain:content}.message{padding:var(--emoji-padding)}';const Ms=["customEmoji","customCategorySorting","database","dataSource","i18n","locale","skinToneEmoji","emojiVersion"],Ji=`:host{--emoji-font-family:${$s}}`;class Os extends HTMLElement{constructor(e){super(),this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent=Zi+Ji,this.shadowRoot.appendChild(t),this._ctx={locale:Yi,dataSource:Qi,skinToneEmoji:hi,customCategorySorting:vi,customEmoji:null,i18n:Xi,emojiVersion:null,...e};for(const n of Ms)n!=="database"&&Object.prototype.hasOwnProperty.call(this,n)&&(this._ctx[n]=this[n],delete this[n]);this._dbFlush()}connectedCallback(){this._cmp||(this._cmp=Wi(this.shadowRoot,this._ctx))}disconnectedCallback(){Kt(()=>{if(!this.isConnected&&this._cmp){this._cmp.$destroy(),this._cmp=void 0;const{database:e}=this._ctx;e.close().catch(t=>console.error(t))}})}static get observedAttributes(){return["locale","data-source","skin-tone-emoji","emoji-version"]}attributeChangedCallback(e,t,n){this._set(e.replace(/-([a-z])/g,(i,o)=>o.toUpperCase()),e==="emoji-version"?parseFloat(n):n)}_set(e,t){this._ctx[e]=t,this._cmp&&this._cmp.$set({[e]:t}),["locale","dataSource"].includes(e)&&this._dbFlush()}_dbCreate(){const{locale:e,dataSource:t,database:n}=this._ctx;(!n||n.locale!==e||n.dataSource!==t)&&this._set("database",new ci({locale:e,dataSource:t}))}_dbFlush(){Kt(()=>this._dbCreate())}}const Ds={};for(const s of Ms)Ds[s]={get(){return s==="database"&&this._dbCreate(),this._ctx[s]},set(e){if(s==="database")throw new Error("database is read-only");this._set(s,e)}};Object.defineProperties(Os.prototype,Ds);customElements.get("emoji-picker")||customElements.define("emoji-picker",Os);const er={class:"chess-board-wrapper"},tr={class:"chess-board"},nr=["onClick","onDrop","onTouchend"],sr=["onDragstart","onTouchstart"],or={key:1,class:"move-indicator"},ir=ds({__name:"ChessBoard",props:{fen:{},playerColor:{},isViewingHistory:{type:Boolean},isDrawOffered:{type:Boolean}},emits:["move","blockedMove"],setup(s,{emit:e}){const t=s,n=e,i=U(new Pn(t.fen)),o=U(null),a=U([]),l=U(null),d=le(()=>!!t.isViewingHistory),r=le(()=>!!t.isDrawOffered),g={p:"‚ôü",r:"‚ôú",n:"‚ôû",b:"‚ôù",q:"‚ôõ",k:"‚ôö",P:"‚ôô",R:"‚ôñ",N:"‚ôò",B:"‚ôó",Q:"‚ôï",K:"‚ôî"};Xe(()=>t.fen,T=>{T&&(i.value=new Pn(T)),o.value=null,a.value=[]});const y=le(()=>{const T=t.playerColor==="white"?["a","b","c","d","e","f","g","h"]:["h","g","f","e","d","c","b","a"],j=t.playerColor==="white"?[8,7,6,5,4,3,2,1]:[1,2,3,4,5,6,7,8],R=[];for(const G of j)for(const Y of T)R.push(`${Y}${G}`);return R});function h(T){const j=i.value.get(T);return j?g[j.type.toUpperCase()===j.type?j.type.toUpperCase():j.type.toLowerCase()]:null}function b(T){const j=i.value.get(T);return j?j.color==="w"?"white":"black":null}function $(T){const j=T.charCodeAt(0)-97,R=parseInt(T[1])-1;return(j+R)%2===1}function F(T){if(d.value)return;if(r.value){n("blockedMove");return}const j=i.value.get(T),R=i.value.turn()==="w"?"white":"black";if(j&&b(T)===t.playerColor&&R===t.playerColor){o.value=T;const G=i.value.moves({square:T,verbose:!0});a.value=G.map(Y=>Y.to)}else o.value&&a.value.includes(T)?H(o.value,T):(o.value=null,a.value=[])}function H(T,j){const R=i.value.get(T),G={from:T,to:j};R&&R.type==="p"&&(R.color==="w"&&j[1]==="8"||R.color==="b"&&j[1]==="1")&&(G.promotion="q"),i.value.move(G)&&(G.promotion?n("move",{from:T,to:j,promotion:G.promotion}):n("move",{from:T,to:j})),o.value=null,a.value=[]}function ne(T,j){if(d.value){T.preventDefault();return}if(r.value){T.preventDefault(),n("blockedMove");return}const R=i.value.get(j),G=i.value.turn()==="w"?"white":"black";if(!R||b(j)!==t.playerColor||G!==t.playerColor){T.preventDefault();return}l.value=j,o.value=j;const Y=i.value.moves({square:j,verbose:!0});a.value=Y.map(ie=>ie.to),T.dataTransfer&&(T.dataTransfer.effectAllowed="move",T.dataTransfer.setData("text/plain",j))}function S(T){T.preventDefault(),T.dataTransfer&&(T.dataTransfer.dropEffect="move")}function K(T,j){T.preventDefault(),!d.value&&(r.value||(l.value&&a.value.includes(j)&&H(l.value,j),l.value=null,o.value=null,a.value=[]))}function Z(){l.value&&(l.value=null,o.value=null,a.value=[])}function V(T,j){if(d.value)return;if(r.value){n("blockedMove");return}const R=i.value.get(j),G=i.value.turn()==="w"?"white":"black";if(!R||b(j)!==t.playerColor||G!==t.playerColor)return;T.preventDefault(),l.value=j,o.value=j;const Y=i.value.moves({square:j,verbose:!0});a.value=Y.map(ie=>ie.to)}function J(T){l.value&&T.preventDefault()}function he(T,j){l.value&&(d.value||r.value||(T.preventDefault(),a.value.includes(j)?H(l.value,j):l.value!==j&&(l.value=null,o.value=null,a.value=[])))}return(T,j)=>(q(),z("div",er,[k("div",tr,[(q(!0),z(Mn,null,fs(y.value,R=>(q(),z("div",{key:R,class:at(["square",$(R)?"light":"dark",{selected:o.value===R},{"valid-move":a.value.includes(R)},{dragging:l.value===R}]),onClick:G=>F(R),onDragover:S,onDrop:G=>K(G,R),onTouchend:G=>he(G,R)},[h(R)?(q(),z("div",{key:0,class:at(["piece",b(R)]),draggable:"true",onDragstart:G=>ne(G,R),onDragend:Z,onTouchstart:G=>V(G,R),onTouchmove:J},C(h(R)),43,sr)):ue("",!0),a.value.includes(R)?(q(),z("div",or)):ue("",!0)],42,nr))),128))])]))}}),rr=hs(ir,[["__scopeId","data-v-7c35ec06"]]),us=8,ar=4,lr={class:"container"},cr={class:"game-container"},ur={class:"game-header"},dr={class:"game-title-text"},fr={class:"user-info"},hr={class:"profile-dropdown"},pr=["aria-label"],mr={class:"profile-menu-header"},vr={class:"profile-menu-item"},gr={class:"profile-label"},_r={class:"profile-value"},br={class:"profile-menu-item"},yr={class:"profile-label"},kr={class:"profile-value"},Er={class:"profile-menu-item"},wr={class:"profile-label"},Sr={class:"profile-value"},Cr={class:"profile-menu-item"},Tr={class:"profile-label"},Ir={class:"profile-value"},xr=["disabled","title"],Ar={key:0,class:"chat-badge"},$r={key:0,class:"game-alert"},jr={key:1,class:"game-status"},Mr={key:2,class:"game-status"},Or={key:3,class:"active-game"},Dr={class:"chessboard-area"},Pr={class:"parent-history-bar"},Lr={class:"history-row"},Nr={class:"history-controls"},Rr=["disabled","aria-label"],Fr={class:"history-pos"},Br=["disabled","aria-label"],Ur={key:1,class:"history-player"},Kr={class:"move-by"},Gr={class:"move-name"},qr={class:"game-id-container"},zr={id:"game-id"},Hr={class:"timer-section timer-below"},Vr={key:0},Wr={key:1,class:"draw-offered-title"},Qr={key:2,class:"timer"},Yr={key:3,class:"draw-offered-actions"},Xr=["disabled"],Zr=["disabled"],Jr={key:4,class:"pass-btn-container"},ea=["disabled"],ta=["disabled"],na={class:"win-header"},sa={class:"win-title"},oa={class:"score-change"},ia={class:"win-title"},ra={class:"score-change"},aa={class:"error-title"},la={class:"error-message"},ca={class:"modal-title"},ua=["innerHTML"],da={class:"modal-actions"},fa=["aria-label"],ha={class:"chat-header"},pa={class:"chat-subtitle"},ma=["aria-label"],va={key:0,class:"chat-error"},ga={key:0,class:"chat-loading"},_a={key:1,class:"chat-empty"},ba={key:2,class:"chat-messages"},ya={class:"chat-meta"},ka={class:"chat-author"},Ea={key:0,class:"chat-self-tag"},wa={class:"chat-meta-details"},Sa=["onClick","aria-label","title"],Ca={class:"chat-time"},Ta={class:"chat-text"},Ia=["placeholder","onKeydown"],xa={class:"chat-form-actions"},Aa=["aria-pressed","title"],$a=["disabled"],ja=2e3,Ma=ds({__name:"game",setup(s){const e=Ls(),t=Ns(),{t:n,locale:i}=Ys(),{user:o,isAuthenticated:a,signout:l,getAuthHeader:d}=Ws(),r=U(null),g=U(!1),y=U(us*60),h=U(null),b=U(null),$=U(null),F=U(null),H=U(!1),ne=U(!1),S=U(""),K=U(null);let Z=Promise.resolve();const V=U(!1),J=U([]),he=U(""),T=U(""),j=U(!1),R=U(!1),G=U(0),Y=U(null),ie=U(null),ge=U(null),Ne=U(!1),je=U(null),pe=U(!1),Me=U(null),ze=U(!1),Re=U(""),xe=U(null),ke=U(!1),Ce=U(null),tt=U({}),He=U(null),Te=U(!1),Ie=U(!1),Fe=le(()=>{if(!r.value||!o.value)return!1;const u=r.value.drawOfferUserId;return u?u.toString()!==o.value._id.toString():!1}),Ve=le(()=>{const u=Array.isArray(t.query.gameId)?t.query.gameId[0]:t.query.gameId;return typeof u=="string"&&u.length?u:void 0}),_=le(()=>{if(r.value&&o.value){if(ee(r.value.whiteUserIds,o.value._id))return"white";if(ee(r.value.blackUserIds,o.value._id))return"black"}return null}),E=le(()=>!!(r.value?._id&&_.value)),M=le(()=>He.value||o.value);async function B(){const u=d();if(u)try{const v=await $fetch("/api/user",{headers:u});He.value=v}catch(v){console.error("Failed to fetch user data:",v)}}function ee(u=[],v){return v?u.some(L=>L?.toString?.()===v):!1}const te=()=>{ke.value=!ke.value,ke.value&&(B(),Ce.value&&Wn(()=>{const u=Ce.value.getBoundingClientRect(),v=220,L=350,D=8,we=window.innerWidth,Se=window.innerHeight;let Q=u.bottom+D,c=we-u.right;we-c-v<D&&(c=we-v-D),c>we-v-D&&(c=we-v-D),Q+L>Se-D&&(Q=u.top-L-D,Q<D&&(Q=D)),tt.value={position:"fixed",top:`${Q}px`,right:`${c}px`,zIndex:"999999"}}))},fe=()=>{ke.value=!1,e.push("/settings")};Rs(()=>{const u=v=>{v.target.closest(".profile-dropdown")||(ke.value=!1)};document.addEventListener("click",u),Hn(()=>{document.removeEventListener("click",u)})}),Qs(u=>{if(ke.value){ke.value=!1,u.preventDefault();return}if(Te.value){Te.value=!1,u.preventDefault();return}if(V.value){X(),u.preventDefault();return}if(H.value){H.value=!1,u.preventDefault();return}ne.value&&(ne.value=!1,u.preventDefault())});function Be(u,v){H.value=!0,$.value=u??null,F.value=v??null,typeof window<"u"&&zs(()=>import("./C2jkTI5u.js"),[],import.meta.url).then(L=>{L.default({particleCount:200,spread:90,origin:{y:.7}})})}const ft=le(()=>r.value.history[r.value.history.length-1].fen),ce=U(0);Xe(r,u=>{u&&u.history&&u.history.length?ce.value=u.history.length-1:ce.value=0});const qt=le(()=>r.value?.history?.length??0),zt=le(()=>{if(!r.value)return ft.value;const u=Math.min(Math.max(0,ce.value),r.value.history.length-1);return r.value.history[u].fen}),ht=le(()=>r.value&&ce.value!==r.value.history.length-1),Et=le(()=>ce.value<=0),Ht=le(()=>r.value?ce.value>=r.value.history.length-1:!0),Vt=le(()=>(r.value?.history?.length??0)>ar);function Wt(){ce.value>0&&ce.value--}function wt(){r.value&&ce.value<r.value.history.length-1&&ce.value++}function Qt(){r.value&&(ce.value=r.value.history.length-1)}function Yt(u){if(!r.value||!r.value.history?.length)return;const v=r.value.history.length-1,L=Math.min(Math.max(0,u),v);ce.value=L}function Xt(u){Yt(u),X()}const pt=le(()=>{const v=r.value.history[ce.value].userId;return(r.value.userDataMap??{})[v]}),Zt=le(()=>{if(!r.value||!o.value)return"white";const v=new Pn(ft.value).turn();return r.value.whiteUserIds?.includes(o.value._id)?"white":r.value.blackUserIds?.includes(o.value._id)?"black":v==="w"?"white":"black"});function Jt(){K.value="/",l(),Ee(),Oe(),ot(),r.value=null,e.replace("/")}async function en(){if(!r.value)return;const u=r.value._id;await me({excludeGameId:u,isForce:!0})}function tn(){Te.value=!0}async function nn(){if(r.value){Te.value=!1;try{const u=d();await $fetch("/api/draw-offer",{method:"POST",body:{gameId:r.value._id},headers:u}),await me({excludeGameId:r.value._id,isForce:!0})}catch(u){const v=Ue(u,n.value)||"Failed to offer draw";console.error("Error offering draw:",v,u)}}}async function St(){if(r.value)try{const u=d();await $fetch("/api/draw-respond",{method:"POST",body:{gameId:r.value._id,isAcceptDraw:!0},headers:u}),ne.value=!0,await me({excludeGameId:r.value._id,isForce:!0})}catch(u){const v=Ue(u,n.value)||"Failed to accept draw";console.error("Error accepting draw:",v,u)}}async function sn(){if(r.value)try{const u=d();await $fetch("/api/draw-respond",{method:"POST",body:{gameId:r.value._id,isAcceptDraw:!1},headers:u}),await me({excludeGameId:r.value._id,isForce:!0})}catch(u){const v=Ue(u,n.value)||"Failed to decline draw";console.error("Error declining draw:",v,u)}}async function me(u={}){const v=!!(u.isForce||u.excludeGameId||u.requestedGameId);if(g.value&&!v)return r.value;g.value=!0;try{const L=new URLSearchParams;u.excludeGameId&&L.set("gameId",u.excludeGameId),u.requestedGameId&&L.set("requestedGameId",u.requestedGameId);const D=L.toString(),we=D?`/api/game?${D}`:"/api/game",Se=d(),Q=await $fetch(we,Se?{headers:Se}:{});return Q?(r.value=Q,Ee(),dn()):(r.value=null,Oe(),f()),Q}catch(L){if(!u.requestedGameId)return console.error("Error loading game:",L),r.value=null,f(),null;throw L}finally{g.value=!1}}async function on(u){S.value="";try{return!!await me({requestedGameId:u,isForce:!0})}catch(v){const L=v?.statusMessage||v?.data?.statusMessage||v?.response?.statusMessage||v?.statusCode;return L==="GAME_NOT_FOUND"?S.value=n.value.requestedGameNotFound:L==="GAME_NOT_AVAILABLE"?S.value=n.value.requestedGameNotAvailable:S.value=Ue(v,n.value)||n.value.errors.ERR_GENERIC,!1}}function rn(u){return r.value?(r.value._id?.toString?.()??r.value._id)===u||String(r.value.id??"")===u:!1}function Ct(){Z=Z.catch(()=>{}).then(()=>an()).catch(u=>{console.error("Failed to load game from queue",u),S.value=Ue(u,n.value)||n.value.errors.ERR_GENERIC})}async function an(){if(!a.value)return;const u=Ve.value;if(u){if(rn(u)){S.value="";return}if(await on(u))return;await me({isForce:!0});return}r.value||await me()}function ln(){const u=t.fullPath||"/game";e.replace({path:"/signin",query:{redirect:u}})}function cn(){Ie.value=!0,setTimeout(()=>{Ie.value=!1},600)}async function un(u){if(r.value)try{const v={gameId:r.value._id,move:u.promotion?{...u,promotion:u.promotion}:u},L=d(),D=await $fetch("/api/move",{method:"POST",body:v,headers:L});D?.result.gameResult==="draw"?ne.value=!0:["white-win","black-win"].includes(D?.result.gameResult)&&Be(D.result.prevScore,D.result.newScore),Oe(),await me({excludeGameId:r.value._id,isForce:!0})}catch(v){if(mn(v)){pn(n.value.moveErrors.notYourTurnMessage);return}const L=Ue(v,n.value)||"Failed to make move";console.error("Error making move:",L,v)}}function dn(){Oe(),y.value=us*60,b.value=Qn(()=>{if(y.value--,y.value<=0&&(Oe(),r.value)){const u={excludeGameId:r.value._id,isForce:!0};V.value?Me.value=u:me(u)}},1e3)}function Oe(){b.value&&(clearInterval(b.value),b.value=null)}function f(){Ee(),h.value=Qn(async()=>{r.value||await me()},4e3)}function Ee(){h.value&&(clearInterval(h.value),h.value=null)}function _e(u){const v=Math.floor(u/60),L=u%60;return`${v}:${L.toString().padStart(2,"0")}`}function Ae(u,v){return u?v?new Date(u).getTime()>new Date(v).getTime():!0:!1}function w(){V.value?X():We()}function We(){E.value&&(V.value=!0,st({force:!0}),it())}function X(){V.value&&(V.value=!1,pe.value=!1)}async function be(){if(R.value)return;const u=he.value.trim(),v=De();if(!u||!v)return;R.value=!0;const L=d();try{await $fetch("/api/chat",{method:"POST",body:{gameId:v,message:u},...L?{headers:L}:{}}),he.value="",T.value="",await st({force:!0}),await it()}catch(D){T.value=Ue(D,n.value)||n.value.teamChat.sendError}finally{R.value=!1}}function fn(){if(!V.value){pe.value=!1;return}pe.value=!pe.value}function ve(u){const v=u.detail,L=v?.unicode||v?.emoji?.unicode;L&&(he.value+=L,pe.value=!1)}function Tt(u){u&&(ie.value&&!Ae(u,ie.value)||(ge.value=u,Ne.value||mt()))}async function mt(){const u=ge.value,v=De();if(!u||!v)return;if(ie.value&&!Ae(u,ie.value)){ge.value=null;return}Ne.value=!0,ge.value=null;const L=d();try{const D=await $fetch("/api/chat/seen",{method:"POST",body:{gameId:v,lastSeenAt:u},...L?{headers:L}:{}});v===De()&&(ie.value=D.lastSeenAt??u)}catch(D){console.error("Failed to persist chat last-seen timestamp",D)}finally{Ne.value=!1,ge.value&&mt()}}function I(u){return(r.value?.userDataMap??{})?.[u]?.name??n.value.unknownPlayer}function hn(u){return Xs(u,i.value||"en","")}function nt(){xe.value&&(clearTimeout(xe.value),xe.value=null)}function It(){ze.value=!1,Re.value="",nt()}function xt(){const u={isForce:!0},v=De();v&&(u.excludeGameId=v),me(u)}function pn(u){nt(),Re.value=u,ze.value=!0,xe.value=setTimeout(()=>{xe.value=null,It(),xt()},ja)}function mn(u){return(u?.statusMessage||u?.data?.statusMessage||u?.response?.statusMessage||u?.response?._data?.statusMessage)==="ERR_NOT_YOUR_TURN"}function De(){const u=r.value?._id??null;return u?typeof u=="string"?u:u?.toString?.()??null:null}async function st(u={}){if(!E.value)return;const v=De();if(!v||j.value&&!u.force)return;j.value=!0;const L=d();try{const D=await $fetch("/api/chat",{query:{gameId:v},...L?{headers:L}:{}});if(De()!==v)return;J.value=D.messages,T.value="";const Se=D.lastSeenAt;Se?(Ae(Se,ie.value)&&(ie.value=Se),Ae(Se,Y.value)&&(Y.value=Se)):(ie.value=null,Y.value=null),At()}catch(D){T.value=Ue(D,n.value)||n.value.teamChat.loadError}finally{j.value=!1}}function ot(){J.value=[],he.value="",T.value="",G.value=0,Y.value=null,ie.value=null,ge.value=null,V.value=!1,pe.value=!1,Me.value=null}function vt(){const u=J.value[J.value.length-1];let v=null;u?v=u.createdDateStr:Y.value||(v=new Date().toISOString()),v&&((Ae(v,Y.value)||!Y.value)&&(Y.value=v),Tt(v)),G.value=0}function At(){if(J.value.length)if(Y.value){const u=new Date(Y.value).getTime();G.value=J.value.filter(v=>new Date(v.createdDateStr).getTime()>u).length}else G.value=J.value.length;else G.value=0}async function it(){await Wn(),je.value&&(je.value.scrollTop=je.value.scrollHeight)}return Xe(()=>({gameId:De(),canChat:E.value}),(u,v)=>{const L=u.gameId!==v?.gameId;(L||!u.canChat)&&ot(),u.gameId&&u.canChat&&L&&st({force:!0})},{immediate:!0}),Xe(J,()=>{V.value?(vt(),it()):At()}),Xe(V,u=>{if(u)vt(),it();else if(pe.value=!1,vt(),Me.value){const v=Me.value;Me.value=null,me(v)}}),Xe(()=>a.value,u=>{if(u)Ct();else{if(Ee(),Oe(),ot(),r.value=null,K.value){K.value=null;return}ln()}},{immediate:!0}),Xe(Ve,(u,v)=>{a.value&&u!==v&&Ct()}),Hn(()=>{Ee(),Oe(),nt()}),(u,v)=>{const L=Hs;return q(),z(Mn,null,[k("div",lr,[k("div",cr,[k("div",ur,[k("h1",null,[v[12]||(v[12]=k("img",{src:Vs,alt:"DistroChess",class:"game-logo"},null,-1)),k("span",dr,C(x(n).distroChess),1),vn(L,{to:"/faq",class:"btn-faq"},{default:Vn(()=>[rt(C(x(n).faq.linkLabel),1)]),_:1}),vn(L,{to:"/leaderboard",class:"btn-faq"},{default:Vn(()=>[rt(C(x(n).leaderboard.linkLabel),1)]),_:1})]),k("div",fr,[k("div",hr,[k("button",{class:"btn-profile",onClick:te,"aria-label":x(n).profile.button,ref_key:"profileButton",ref:Ce},[...v[13]||(v[13]=[k("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",width:"24",height:"24",fill:"currentColor"},[k("path",{d:"M256 0c141.385 0 256 114.615 256 256S397.385 512 256 512 0 397.385 0 256 114.615 0 256 0zm0 480c123.712 0 224-100.288 224-224S379.712 32 256 32 32 132.288 32 256s100.288 224 224 224z"}),k("path",{d:"M256 192c35.346 0 64-28.654 64-64s-28.654-64-64-64-64 28.654-64 64 28.654 64 64 64zm0-96c17.673 0 32 14.327 32 32s-14.327 32-32 32-32-14.327-32-32 14.327-32 32-32zm116.8 192c-22.4-28.8-67.2-48-116.8-48s-94.4 19.2-116.8 48c-6.4 9.6-9.6 19.2-9.6 32 0 35.2 28.8 64 64 64h128c35.2 0 64-28.8 64-64 0-12.8-3.2-22.4-12.8-32zm-180.8 64c-17.6 0-32-14.4-32-32 0-3.2 0-6.4 3.2-9.6 12.8-19.2 51.2-38.4 92.8-38.4s80 19.2 92.8 38.4c3.2 3.2 3.2 6.4 3.2 9.6 0 17.6-14.4 32-32 32H192z"})],-1)])],8,pr),(q(),Fs(Us,{to:"body"},[ke.value?(q(),z("div",{key:0,class:"profile-menu",style:Bs(tt.value)},[k("div",mr,[k("strong",null,C(M.value?.name),1)]),k("div",vr,[k("span",gr,C(x(n).profile.score),1),k("span",_r,C(Math.round(M.value?.score??0)),1)]),k("div",br,[k("span",yr,C(x(n).profile.wins),1),k("span",kr,C(M.value?.wins?.length??0),1)]),k("div",Er,[k("span",wr,C(x(n).profile.losses),1),k("span",Sr,C(M.value?.losses?.length??0),1)]),k("div",Cr,[k("span",Tr,C(x(n).profile.draws),1),k("span",Ir,C(M.value?.draws?.length??0),1)]),v[15]||(v[15]=k("div",{class:"profile-menu-divider"},null,-1)),k("button",{class:"profile-menu-settings",onClick:fe},[v[14]||(v[14]=k("img",{src:Zs,alt:"",class:"settings-icon-small"},null,-1)),rt(" "+C(x(n).settings.button),1)]),k("button",{class:"profile-menu-settings btn-signout",onClick:Jt},C(x(n).signout),1)],4)):ue("",!0)]))]),k("button",{class:"btn-team-chat",onClick:w,disabled:!E.value||!r.value,title:E.value?void 0:x(n).teamChat.disabledHint},[rt(C(x(n).teamChat.button)+" ",1),G.value>0?(q(),z("span",Ar,C(G.value),1)):ue("",!0)],8,xr)])]),S.value?(q(),z("div",$r,C(S.value),1)):ue("",!0),g.value?(q(),z("div",jr,[k("p",null,C(x(n).loadingGame),1)])):r.value?(q(),z("div",Or,[k("div",Dr,[vn(rr,{fen:zt.value,"player-color":Zt.value,"is-viewing-history":ht.value,"is-draw-offered":Fe.value,onMove:un,onBlockedMove:cn},null,8,["fen","player-color","is-viewing-history","is-draw-offered"]),k("div",Pr,[k("div",Lr,[k("div",Nr,[k("button",{class:"history-btn",onClick:Pe(Wt,["prevent"]),disabled:Et.value,"aria-label":x(n).previousPosition}," ‚Äπ ",8,Rr),k("span",Fr,C(ce.value+1)+" / "+C(qt.value),1),k("button",{class:"history-btn",onClick:Pe(wt,["prevent"]),disabled:Ht.value,"aria-label":x(n).nextPosition}," ‚Ä∫ ",8,Br)])]),ht.value?(q(),z("button",{key:0,class:"history-pill history-pill-btn",onClick:Qt},C(x(n).exitHistory),1)):ue("",!0),r.value&&pt.value?(q(),z("div",Ur,[k("span",Kr,C(ht.value?x(n).moveBy:x(n).lastMoveBy),1),k("span",Gr,C(pt.value.name)+" ("+C(x(n).score)+" : "+C(Math.round(pt.value.score))+")",1)])):ue("",!0),k("div",qr,[rt(C(x(n).gameId)+": ",1),k("span",zr,C(r.value.id),1)])])]),k("div",Hr,[Fe.value?(q(),z("h3",Wr,C(x(n).drawOffered.title),1)):(q(),z("h3",Vr,C(x(n).yourTurn),1)),Fe.value?ue("",!0):(q(),z("div",Qr,[k("div",{class:at(["timer-value",{warning:y.value<20}])},C(_e(y.value)),3)])),Fe.value?(q(),z("div",Yr,[k("button",{class:at(["btn-accept-draw",{pulse:Ie.value}]),onClick:St,disabled:!r.value},C(x(n).drawOffered.accept),11,Xr),k("button",{class:at(["btn-decline-draw",{pulse:Ie.value}]),onClick:sn,disabled:!r.value},C(x(n).drawOffered.decline),11,Zr)])):(q(),z("div",Jr,[k("button",{class:"btn-pass",onClick:en,disabled:!r.value},C(x(n).pass),9,ea),k("button",{class:"btn-offer-draw",onClick:tn,disabled:!r.value||!Vt.value},C(x(n).offerDraw),9,ta)]))])])):(q(),z("div",Mr,[k("p",null,C(x(n).waitingForOpponent),1),v[16]||(v[16]=k("div",{class:"loading-spinner"},null,-1))]))])]),H.value?(q(),z("div",{key:0,class:"modal-overlay",onClick:v[2]||(v[2]=D=>H.value=!1)},[k("div",{class:"modal-content",onClick:v[1]||(v[1]=Pe(()=>{},["stop"]))},[k("div",na,[v[17]||(v[17]=k("span",{class:"win-icon","aria-hidden":"true"},"üéâ",-1)),k("h1",sa,C(x(n).winCongrats),1),v[18]||(v[18]=k("span",{class:"win-icon","aria-hidden":"true"},"üéâ",-1))]),k("p",oa,C(x(n).winScoreChange({prevScore:$.value?Math.round($.value):"?",newScore:F.value?Math.round(F.value):"?"})),1),k("button",{class:"close-btn",onClick:v[0]||(v[0]=D=>H.value=!1)},C(x(n).close),1)])])):ne.value?(q(),z("div",{key:1,class:"modal-overlay",onClick:v[5]||(v[5]=D=>ne.value=!1)},[k("div",{class:"modal-content",onClick:v[4]||(v[4]=Pe(()=>{},["stop"]))},[k("h1",ia,C(x(n).gameDrawn),1),k("p",ra,C(x(n).noScoreChange),1),k("button",{class:"close-btn",onClick:v[3]||(v[3]=D=>ne.value=!1)},C(x(n).close),1)])])):ue("",!0),ze.value?(q(),z("div",{key:2,class:"modal-overlay error-modal",onClick:It},[k("div",{class:"modal-content error-modal-content",onClick:v[6]||(v[6]=Pe(()=>{},["stop"]))},[k("h2",aa,C(x(n).moveErrors.notYourTurnTitle),1),k("p",la,C(Re.value),1)])])):ue("",!0),Te.value?(q(),z("div",{key:3,class:"modal-overlay",onClick:v[9]||(v[9]=D=>Te.value=!1)},[k("div",{class:"modal-content",onClick:v[8]||(v[8]=Pe(()=>{},["stop"]))},[k("h2",ca,C(x(n).drawOffer.title),1),k("p",{class:"modal-message",innerHTML:x(n).drawOffer.message},null,8,ua),k("div",da,[k("button",{class:"btn-primary",onClick:nn},C(x(n).drawOffer.confirm),1),k("button",{class:"btn-secondary",onClick:v[7]||(v[7]=D=>Te.value=!1)},C(x(n).drawOffer.cancel),1)])])])):ue("",!0),V.value?(q(),z("div",{key:4,class:"modal-overlay chat-overlay",onClick:X},[k("div",{class:"chat-modal",role:"dialog","aria-modal":"true","aria-label":x(n).teamChat.title,onClick:v[11]||(v[11]=Pe(()=>{},["stop"]))},[k("div",ha,[k("div",null,[k("h2",null,C(x(n).teamChat.title),1),k("p",pa,C(x(n).teamChat.subtitle),1)]),k("button",{class:"chat-close",onClick:X,"aria-label":x(n).close}," √ó ",8,ma)]),T.value?(q(),z("div",va,C(T.value),1)):ue("",!0),k("div",{class:"chat-body",ref_key:"chatBodyRef",ref:je},[j.value&&!J.value.length?(q(),z("div",ga,C(x(n).teamChat.loading),1)):J.value.length?(q(),z("div",ba,[(q(!0),z(Mn,null,fs(J.value,D=>(q(),z("div",{key:D.id,class:at(["chat-message",{"chat-message-self":D.userId===x(o)?._id}])},[k("div",ya,[k("span",ka,[rt(C(I(D.userId))+" ",1),D.userId===x(o)?._id?(q(),z("span",Ea,C(x(n).teamChat.you),1)):ue("",!0)]),k("div",wa,[typeof D.moveNumber=="number"?(q(),z("button",{key:0,type:"button",class:"chat-move",onClick:we=>Xt(D.moveNumber),"aria-label":x(n).teamChat.moveNumberLabel({move:D.moveNumber+1}),title:x(n).teamChat.moveNumberLabel({move:D.moveNumber+1})},C(x(n).teamChat.moveNumberLabel({move:D.moveNumber+1})),9,Sa)):ue("",!0),k("span",Ca,C(hn(D.createdDateStr)),1)])]),k("p",Ta,C(D.message),1)],2))),128))])):(q(),z("div",_a,C(x(n).teamChat.empty),1))],512),k("form",{class:"chat-form",onSubmit:Pe(be,["prevent"])},[Ks(k("textarea",{class:"chat-input",rows:"3","onUpdate:modelValue":v[10]||(v[10]=D=>he.value=D),placeholder:x(n).teamChat.placeholder,onKeydown:qs(Pe(be,["exact","prevent"]),["enter"])},null,40,Ia),[[Gs,he.value]]),k("div",xa,[k("button",{type:"button",class:"chat-emoji-btn","aria-pressed":pe.value,onClick:fn,title:x(n).teamChat.emojiToggle}," üòä ",8,Aa),k("button",{type:"submit",class:"chat-send-btn",disabled:R.value||!he.value.trim()},C(R.value?x(n).teamChat.sending:x(n).teamChat.send),9,$a)]),pe.value?(q(),z("emoji-picker",{key:0,class:"emoji-picker",onEmojiClick:ve},null,32)):ue("",!0)],32)],8,fa)])):ue("",!0)],64)}}}),Ua=hs(Ma,[["__scopeId","data-v-f8913280"]]);export{Ua as default};
//# sourceMappingURL=BHUSe8qr.js.map
